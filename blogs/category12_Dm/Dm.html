<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设计模式 | MyBlog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="lpy的个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.cdd75a34.css" as="style"><link rel="preload" href="/assets/js/app.b77bd91d.js" as="script"><link rel="preload" href="/assets/js/5.95fafd89.js" as="script"><link rel="preload" href="/assets/js/1.8004d325.js" as="script"><link rel="preload" href="/assets/js/4.c5305843.js" as="script"><link rel="prefetch" href="/assets/js/10.d2057572.js"><link rel="prefetch" href="/assets/js/100.5ee92836.js"><link rel="prefetch" href="/assets/js/101.c42d6c40.js"><link rel="prefetch" href="/assets/js/102.4cc4aafb.js"><link rel="prefetch" href="/assets/js/103.e2ae2ab4.js"><link rel="prefetch" href="/assets/js/104.27435640.js"><link rel="prefetch" href="/assets/js/105.560c84a4.js"><link rel="prefetch" href="/assets/js/106.5a4cf765.js"><link rel="prefetch" href="/assets/js/107.7626cf3d.js"><link rel="prefetch" href="/assets/js/108.3b10de57.js"><link rel="prefetch" href="/assets/js/109.a0e81730.js"><link rel="prefetch" href="/assets/js/11.21f4368d.js"><link rel="prefetch" href="/assets/js/12.a09fd564.js"><link rel="prefetch" href="/assets/js/13.cb753bda.js"><link rel="prefetch" href="/assets/js/14.cac8a8d9.js"><link rel="prefetch" href="/assets/js/15.a438db96.js"><link rel="prefetch" href="/assets/js/16.4b0695bf.js"><link rel="prefetch" href="/assets/js/17.e00e88a3.js"><link rel="prefetch" href="/assets/js/18.e7e67886.js"><link rel="prefetch" href="/assets/js/19.4ff01257.js"><link rel="prefetch" href="/assets/js/20.25f67462.js"><link rel="prefetch" href="/assets/js/21.7733630a.js"><link rel="prefetch" href="/assets/js/22.4e08b6fc.js"><link rel="prefetch" href="/assets/js/23.6ea04250.js"><link rel="prefetch" href="/assets/js/24.e2da0d90.js"><link rel="prefetch" href="/assets/js/25.a534d6f4.js"><link rel="prefetch" href="/assets/js/26.35aa4ca1.js"><link rel="prefetch" href="/assets/js/27.eed98fd3.js"><link rel="prefetch" href="/assets/js/28.5aa99d4d.js"><link rel="prefetch" href="/assets/js/29.6ebe6a82.js"><link rel="prefetch" href="/assets/js/3.133d4682.js"><link rel="prefetch" href="/assets/js/30.28932870.js"><link rel="prefetch" href="/assets/js/31.03e69fea.js"><link rel="prefetch" href="/assets/js/32.338c87c0.js"><link rel="prefetch" href="/assets/js/33.1dae9eb6.js"><link rel="prefetch" href="/assets/js/34.a93f2c2a.js"><link rel="prefetch" href="/assets/js/35.e7405357.js"><link rel="prefetch" href="/assets/js/36.b46637a5.js"><link rel="prefetch" href="/assets/js/37.93d4f4ef.js"><link rel="prefetch" href="/assets/js/38.bee790ba.js"><link rel="prefetch" href="/assets/js/39.ebfb7888.js"><link rel="prefetch" href="/assets/js/40.df4f0271.js"><link rel="prefetch" href="/assets/js/41.b8e4dec5.js"><link rel="prefetch" href="/assets/js/42.a1f93525.js"><link rel="prefetch" href="/assets/js/43.6041684a.js"><link rel="prefetch" href="/assets/js/44.9563ec90.js"><link rel="prefetch" href="/assets/js/45.6bf87186.js"><link rel="prefetch" href="/assets/js/46.4aaec7b5.js"><link rel="prefetch" href="/assets/js/47.78c12023.js"><link rel="prefetch" href="/assets/js/48.869d79e3.js"><link rel="prefetch" href="/assets/js/49.a764a009.js"><link rel="prefetch" href="/assets/js/50.4856b130.js"><link rel="prefetch" href="/assets/js/51.7bd709d0.js"><link rel="prefetch" href="/assets/js/52.b72beb04.js"><link rel="prefetch" href="/assets/js/53.d84ae00d.js"><link rel="prefetch" href="/assets/js/54.364629ea.js"><link rel="prefetch" href="/assets/js/55.cb9d365f.js"><link rel="prefetch" href="/assets/js/56.7cb864d7.js"><link rel="prefetch" href="/assets/js/57.c63788a3.js"><link rel="prefetch" href="/assets/js/58.af360c05.js"><link rel="prefetch" href="/assets/js/59.e2730c29.js"><link rel="prefetch" href="/assets/js/6.9a64070c.js"><link rel="prefetch" href="/assets/js/60.917ecde4.js"><link rel="prefetch" href="/assets/js/61.8766615a.js"><link rel="prefetch" href="/assets/js/62.62c06915.js"><link rel="prefetch" href="/assets/js/63.7d7474c6.js"><link rel="prefetch" href="/assets/js/64.607bafc4.js"><link rel="prefetch" href="/assets/js/65.d75c8339.js"><link rel="prefetch" href="/assets/js/66.17aabf3a.js"><link rel="prefetch" href="/assets/js/67.ea75d796.js"><link rel="prefetch" href="/assets/js/68.0cf80928.js"><link rel="prefetch" href="/assets/js/69.deafd6a3.js"><link rel="prefetch" href="/assets/js/7.12c878df.js"><link rel="prefetch" href="/assets/js/70.6b14ed32.js"><link rel="prefetch" href="/assets/js/71.0dc35275.js"><link rel="prefetch" href="/assets/js/72.e4c8af73.js"><link rel="prefetch" href="/assets/js/73.2ea0d256.js"><link rel="prefetch" href="/assets/js/74.b9e8b353.js"><link rel="prefetch" href="/assets/js/75.34c28988.js"><link rel="prefetch" href="/assets/js/76.dcb700d3.js"><link rel="prefetch" href="/assets/js/77.9f66d64a.js"><link rel="prefetch" href="/assets/js/78.da9ca9c6.js"><link rel="prefetch" href="/assets/js/79.655ae991.js"><link rel="prefetch" href="/assets/js/8.cd9df2b2.js"><link rel="prefetch" href="/assets/js/80.1bfa7f9c.js"><link rel="prefetch" href="/assets/js/81.95c63156.js"><link rel="prefetch" href="/assets/js/82.2c0cede7.js"><link rel="prefetch" href="/assets/js/83.3537c34b.js"><link rel="prefetch" href="/assets/js/84.5cc5808a.js"><link rel="prefetch" href="/assets/js/85.3c5a7bbf.js"><link rel="prefetch" href="/assets/js/86.3d554d84.js"><link rel="prefetch" href="/assets/js/87.819a68b7.js"><link rel="prefetch" href="/assets/js/88.35514086.js"><link rel="prefetch" href="/assets/js/89.07921821.js"><link rel="prefetch" href="/assets/js/9.4805c803.js"><link rel="prefetch" href="/assets/js/90.05271c7f.js"><link rel="prefetch" href="/assets/js/91.99fd62f9.js"><link rel="prefetch" href="/assets/js/92.be0ea552.js"><link rel="prefetch" href="/assets/js/93.4bb9023a.js"><link rel="prefetch" href="/assets/js/94.15fcabbf.js"><link rel="prefetch" href="/assets/js/95.1dd63304.js"><link rel="prefetch" href="/assets/js/96.3037abca.js"><link rel="prefetch" href="/assets/js/97.7476c904.js"><link rel="prefetch" href="/assets/js/98.0ea6a565.js"><link rel="prefetch" href="/assets/js/99.b4d763b2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cdd75a34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>MyBlog</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>lpy的个人博客</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>lpy</span>
            
          <span data-v-25ba6db2>2019 - </span>
          2024
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="MyBlog" class="logo"> <span class="site-name">MyBlog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      文章分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hadoop/" class="nav-link"><i class="undefined"></i>
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/categories/git/" class="nav-link"><i class="undefined"></i>
  git
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nginx/" class="nav-link"><i class="undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/categories/Swagger/" class="nav-link"><i class="undefined"></i>
  Swagger
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/RedBlackTree/" class="nav-link"><i class="undefined"></i>
  RedBlackTree
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/Pytorch/" class="nav-link"><i class="undefined"></i>
  Pytorch
</a></li><li class="dropdown-item"><!----> <a href="/categories/ML/" class="nav-link"><i class="undefined"></i>
  ML
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/JDBC/" class="nav-link"><i class="undefined"></i>
  JDBC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaEE/" class="nav-link"><i class="undefined"></i>
  JavaEE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/Maven/" class="nav-link"><i class="undefined"></i>
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/categories/Springboot/" class="nav-link"><i class="undefined"></i>
  Springboot
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/elasticsearch/" class="nav-link"><i class="undefined"></i>
  elasticsearch
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blogs/" class="nav-link router-link-active"><i class="iconfont reco-message"></i>
  Java
</a></div><div class="nav-item"><a href="/docs/category7_SSM.html" class="nav-link"><i class="iconfont reco-message"></i>
  框架
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      架构
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/jiagou/spirngcloud/" class="nav-link"><i class="undefined"></i>
  SpirngCloud
</a></li><li class="dropdown-item"><!----> <a href="/docs/jiagou/weifuwu/" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/docs/jiagou/fenbushi/" class="nav-link"><i class="undefined"></i>
  分布式
</a></li></ul></div></div><div class="nav-item"><a href="/docs/code-life/" class="nav-link"><i class="iconfont reco-message"></i>
  程序人生
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    lpy
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>98</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>73</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      文章分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hadoop/" class="nav-link"><i class="undefined"></i>
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/categories/Hive/" class="nav-link"><i class="undefined"></i>
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/categories/git/" class="nav-link"><i class="undefined"></i>
  git
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nginx/" class="nav-link"><i class="undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/categories/Swagger/" class="nav-link"><i class="undefined"></i>
  Swagger
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/RedBlackTree/" class="nav-link"><i class="undefined"></i>
  RedBlackTree
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/Pytorch/" class="nav-link"><i class="undefined"></i>
  Pytorch
</a></li><li class="dropdown-item"><!----> <a href="/categories/ML/" class="nav-link"><i class="undefined"></i>
  ML
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/JDBC/" class="nav-link"><i class="undefined"></i>
  JDBC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaEE/" class="nav-link"><i class="undefined"></i>
  JavaEE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Web/" class="nav-link"><i class="undefined"></i>
  Web
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/Maven/" class="nav-link"><i class="undefined"></i>
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/categories/Springboot/" class="nav-link"><i class="undefined"></i>
  Springboot
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/elasticsearch/" class="nav-link"><i class="undefined"></i>
  elasticsearch
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blogs/" class="nav-link router-link-active"><i class="iconfont reco-message"></i>
  Java
</a></div><div class="nav-item"><a href="/docs/category7_SSM.html" class="nav-link"><i class="iconfont reco-message"></i>
  框架
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      架构
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/jiagou/spirngcloud/" class="nav-link"><i class="undefined"></i>
  SpirngCloud
</a></li><li class="dropdown-item"><!----> <a href="/docs/jiagou/weifuwu/" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/docs/jiagou/fenbushi/" class="nav-link"><i class="undefined"></i>
  分布式
</a></li></ul></div></div><div class="nav-item"><a href="/docs/code-life/" class="nav-link"><i class="iconfont reco-message"></i>
  程序人生
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>设计模式</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>lpy</span>
            
          <span data-v-25ba6db2>2019 - </span>
          2024
        </a></span></div></div> <div data-v-1aefc0b4><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">设计模式</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>lpy</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>7/15/2022</span></i> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/blogs/category12_Dm/Dm.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>设计模式</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="面向对象设计原则"><a href="#面向对象设计原则" class="header-anchor">#</a> 面向对象设计原则</h2> <h3 id="单一职责"><a href="#单一职责" class="header-anchor">#</a> 单一职责</h3> <p>单一职责原则是最简单的面向对象设计原则，它用于控制类的粒度大小。单一职责原则定义如下：</p> <p>单一职责原则(Single Responsibility Principle, SRP)：一个类只负责一个功能领域中的相应职责，或者可以定义为：就一个类而言，应该只有一个引起它变化的原因。</p> <p>单一职责原则告诉我们：一个类不能太“累”！在软件系统中，一个类（大到模块，小到方法）承担的职责越多，它被复用的可能性就越小，而且一个类承担的职责过多，就相当于将这些职责耦合在一起，当其中一个职责变化时，可能会影响其他职责的运作，因此要将这些职责进行分离，将不同的职责封装在不同的类中，即将不同的变化原因封装在不同的类中，如果多个职责总是同时发生改变则可将它们封装在同一类中。</p> <p>单一职责原则是实现高内聚、低耦合的指导方针，它是最简单但又最难运用的原则，需要设计人员发现类的不同职责并将其分离，而发现类的多重职责需要设计人员具有较强的分析设计能力和相关实践经验。</p> <p>下面通过一个简单实例来进一步分析单一职责原则：</p> <p>Sunny软件公司开发人员针对某CRM（Customer Relationship  Management，客户关系管理）系统中客户信息图形统计模块提出了如图1所示初始设计方案：</p> <p><img src="/assets/img/s1.b4925454.jpg" alt=""></p> <p>在图1中，CustomerDataChart类中的方法说明如下：getConnection()方法用于连接数据库，findCustomers()用于查询所有的客户信息，createChart()用于创建图表，displayChart()用于显示图表。</p> <p>现使用单一职责原则对其进行重构。</p> <p>在图1中，CustomerDataChart类承担了太多的职责，既包含与数据库相关的方法，又包含与图表生成和显示相关的方法。如果在其他类中也需要连接数据库或者使用findCustomers()方法查询客户信息，则难以实现代码的重用。无论是修改数据库连接方式还是修改图表显示方式都需要修改该类，它不止一个引起它变化的原因，违背了单一职责原则。因此需要对该类进行拆分，使其满足单一职责原则，类CustomerDataChart可拆分为如下三个类：</p> <div class="language- extra-class"><pre><code>  (1) DBUtil：负责连接数据库，包含数据库连接方法getConnection()；

  (2) CustomerDAO：负责操作数据库中的Customer表，包含对Customer表的增删改查等方法，如findCustomers()；

  (3) CustomerDataChart：负责图表的生成和显示，包含方法createChart()和displayChart()。
</code></pre></div><p>使用单一职责原则重构后的结构如图2所示：
<img src="/assets/img/s2.3830b949.jpg" alt=""></p> <h3 id="开闭原则"><a href="#开闭原则" class="header-anchor">#</a> 开闭原则</h3> <p>开闭原则是面向对象的可复用设计的第一块基石，它是最重要的面向对象设计原则。开闭原则由Bertrand  Meyer于1988年提出，其定义如下：</p> <p>开闭原则(Open-Closed Principle, OCP)：一个软件实体应当对扩展开放，对修改关闭。即软件实体应尽量在不修改原有代码的情况下进行扩展。</p> <p>在开闭原则的定义中，软件实体可以指一个软件模块、一个由多个类组成的局部结构或一个独立的类。</p> <p>任何软件都需要面临一个很重要的问题，即它们的需求会随时间的推移而发生变化。当软件系统需要面对新的需求时，我们应该尽量保证系统的设计框架是稳定的。如果一个软件设计符合开闭原则，那么可以非常方便地对系统进行扩展，而且在扩展时无须修改现有代码，使得软件系统在拥有适应性和灵活性的同时具备较好的稳定性和延续性。随着软件规模越来越大，软件寿命越来越长，软件维护成本越来越高，设计满足开闭原则的软件系统也变得越来越重要。</p> <p>为了满足开闭原则，需要对系统进行抽象化设计，抽象化是开闭原则的关键。在Java、C#等编程语言中，可以为系统定义一个相对稳定的抽象层，而将不同的实现行为移至具体的实现层中完成。在很多面向对象编程语言中都提供了接口、抽象类等机制，可以通过它们定义系统的抽象层，再通过具体类来进行扩展。如果需要修改系统的行为，无须对抽象层进行任何改动，只需要增加新的具体类来实现新的业务功能即可，实现在不修改已有代码的基础上扩展系统的功能，达到开闭原则的要求。</p> <div class="language- extra-class"><pre><code>  Sunny软件公司开发的CRM系统可以显示各种类型的图表，如饼状图和柱状图等，为了支持多种图表显示方式，原始设计方案如图1所示：
</code></pre></div><p><img src="/assets/img/s3.51ceed8a.jpg" alt=""></p> <p>图1 初始设计方案结构图</p> <p>在ChartDisplay类的display()方法中存在如下代码片段：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;pie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">PieChart</span> chart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PieChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chart<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">BarChart</span> chart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BarChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chart<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在该代码中，如果需要增加一个新的图表类，如折线图LineChart，则需要修改ChartDisplay类的display()方法的源代码，增加新的判断逻辑，违反了开闭原则。</p> <p>现对该系统进行重构，使之符合开闭原则。</p> <p>在本实例中，由于在ChartDisplay类的display()方法中针对每一个图表类编程，因此增加新的图表类不得不修改源代码。可以通过抽象化的方式对系统进行重构，使之增加新的图表类时无须修改源代码，满足开闭原则。具体做法如下：</p> <p>(1) 增加一个抽象图表类AbstractChart，将各种具体图表类作为其子类；</p> <p>(2)  ChartDisplay类针对抽象图表类进行编程，由客户端来决定使用哪种具体图表。
重构后结构如图2所示：</p> <p><img src="/assets/img/s4.f91f6b86.jpg" alt=""></p> <p>在图2中，我们引入了抽象图表类AbstractChart，且ChartDisplay针对抽象图表类进行编程，并通过setChart()方法由客户端来设置实例化的具体图表对象，在ChartDisplay的display()方法中调用chart对象的display()方法显示图表。如果需要增加一种新的图表，如折线图LineChart，只需要将LineChart也作为AbstractChart的子类，在客户端向ChartDisplay中注入一个LineChart对象即可，无须修改现有类库的源代码。</p> <p>注意：因为xml和properties等格式的配置文件是纯文本文件，可以直接通过VI编辑器或记事本进行编辑，且无须编译，因此在软件开发中，一般不把对配置文件的修改认为是对系统源代码的修改。如果一个系统在扩展时只涉及到修改配置文件，而原有的Java代码或C#代码没有做任何修改，该系统即可认为是一个符合开闭原则的系统。</p> <h3 id="里氏代换"><a href="#里氏代换" class="header-anchor">#</a> 里氏代换</h3> <p>里氏代换原则(Liskov Substitution Principle, LSP)：所有引用基类（父类）的地方必须能透明地使用其子类的对象。
里氏代换原则告诉我们，在软件中将一个基类对象替换成它的子类对象，程序将不会产生任何错误和异常，反过来则不成立，如果一个软件实体使用的是一个子类对象的话，那么它不一定能够使用基类对象。例如：我喜欢动物，那我一定喜欢狗，因为狗是动物的子类；但是我喜欢狗，不能据此断定我喜欢动物，因为我并不喜欢老鼠，虽然它也是动物。</p> <p>例如有两个类，一个类为BaseClass，另一个是SubClass类，并且SubClass类是BaseClass类的子类，那么一个方法如果可以接受一个BaseClass类型的基类对象base的话，如：method1(base)，那么它必然可以接受一个BaseClass类型的子类对象sub，method1(sub)能够正常运行。反过来的代换不成立，如一个方法method2接受BaseClass类型的子类对象sub为参数：method2(sub)，那么一般而言不可以有method2(base)，除非是重载方法。</p> <p>里氏代换原则是实现开闭原则的重要方式之一，由于使用基类对象的地方都可以使用子类对象，因此在程序中尽量使用基类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象。
在使用里氏代换原则时需要注意如下几个问题：</p> <p>(1)子类的所有方法必须在父类中声明，或子类必须实现父类中声明的所有方法。根据里氏代换原则，为了保证系统的扩展性，在程序中通常使用父类来进行定义，如果一个方法只存在子类中，在父类中不提供相应的声明，则无法在以父类定义的对象中使用该方法。</p> <p>(2)  我们在运用里氏代换原则时，尽量把父类设计为抽象类或者接口，让子类继承父类或实现父接口，并实现在父类中声明的方法，运行时，子类实例替换父类实例，我们可以很方便地扩展系统的功能，同时无须修改原有子类的代码，增加新的功能可以通过增加一个新的子类来实现。里氏代换原则是开闭原则的具体实现手段之一。</p> <p>(3) Java语言中，在编译阶段，Java编译器会检查一个程序是否符合里氏代换原则，这是一个与实现无关的、纯语法意义上的检查，但Java编译器的检查是有局限的。</p> <div class="language- extra-class"><pre><code>  在Sunny软件公司开发的CRM系统中，客户(Customer)可以分为VIP客户(VIPCustomer)和普通客户(CommonCustomer)两类，系统需要提供一个发送Email的功能，原始设计方案如图1所示：
</code></pre></div><p><img src="/assets/img/s5.981c8948.jpg" alt=""></p> <p>图1原始结构图</p> <p>在对系统进行进一步分析后发现，无论是普通客户还是VIP客户，发送邮件的过程都是相同的，也就是说两个send()方法中的代码重复，而且在本系统中还将增加新类型的客户。为了让系统具有更好的扩展性，同时减少代码重复，使用里氏代换原则对其进行重构。</p> <p>在本实例中，可以考虑增加一个新的抽象客户类Customer，而将CommonCustomer和VIPCustomer类作为其子类，邮件发送类EmailSender类针对抽象客户类Customer编程，根据里氏代换原则，能够接受基类对象的地方必然能够接受子类对象，因此将EmailSender中的send()方法的参数类型改为Customer，如果需要增加新类型的客户，只需将其作为Customer类的子类即可。重构后的结构如图2所示：</p> <p><img src="/assets/img/s6.fc4f14d7.jpg" alt=""></p> <p>**里氏代换原则是实现开闭原则的重要方式之一。**在本实例中，在传递参数时使用基类对象，除此以外，在定义成员变量、定义局部变量、确定方法返回类型时都可使用里氏代换原则。针对基类编程，在程序运行时再确定具体子类。</p> <h3 id="依赖倒转"><a href="#依赖倒转" class="header-anchor">#</a> 依赖倒转</h3> <p>如果说开闭原则是面向对象设计的目标的话，那么依赖倒转原则就是面向对象设计的主要实现机制之一，它是系统抽象化的具体实现。依赖倒转原则是Robert C. Martin在1996年为“C++Reporter”所写的专栏Engineering Notebook的第三篇，后来加入到他在2002年出版的经典著作“Agile Software Development, Principles, Patterns, and Practices”一书中。依赖倒转原则定义如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>依赖倒转原则(Dependency Inversion  Principle, DIP)：抽象不应该依赖于细节，细节应当依赖于抽象。换言之，要针对接口编程，而不是针对实现编程。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>依赖倒转原则要求我们在程序代码中传递参数时或在关联关系中，尽量引用层次高的抽象层类，即使用接口和抽象类进行变量类型声明、参数类型声明、方法返回类型声明，以及数据类型的转换等，而不要用具体类来做这些事情。为了确保该原则的应用，一个具体类应当只实现接口或抽象类中声明过的方法，而不要给出多余的方法，否则将无法调用到在子类中增加的新方法。</p> <p>在引入抽象层后，系统将具有很好的灵活性，在程序中尽量使用抽象层进行编程，而将具体类写在配置文件中，这样一来，如果系统行为发生变化，只需要对抽象层进行扩展，并修改配置文件，而无须修改原有系统的源代码，在不修改的情况下来扩展系统的功能，满足开闭原则的要求。</p> <p>在实现依赖倒转原则时，我们需要针对抽象层编程，而将具体类的对象通过依赖注入(DependencyInjection, DI)的方式注入到其他对象中，依赖注入是指当一个对象要与其他对象发生依赖关系时，通过抽象来注入所依赖的对象。常用的注入方式有三种，分别是：构造注入，设值注入（Setter注入）和接口注入。构造注入是指通过构造函数来传入具体类的对象，设值注入是指通过Setter方法来传入具体类的对象，而接口注入是指通过在接口中声明的业务方法来传入具体类的对象。这些方法在定义时使用的是抽象类型，在运行时再传入具体类型的对象，由子类对象来覆盖父类对象。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> Sunny软件公司开发人员在开发某CRM系统时发现：该系统经常需要将存储在TXT或Excel文件中的客户信息转存到数据库中，因此需要进行数据格式转换。在客户数据操作类中将调用数据格式转换类的方法实现格式转换和数据库插入操作，初始设计方案结构如图1所示：
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/s7.17c16631.jpg" alt=""></p> <p>图1 初始设计方案结构图</p> <p>在编码实现图1所示结构时，Sunny软件公司开发人员发现该设计方案存在一个非常严重的问题，由于每次转换数据时数据来源不一定相同，因此需要更换数据转换类，如有时候需要将TXTDataConvertor改为ExcelDataConvertor，此时，需要修改CustomerDAO的源代码，而且在引入并使用新的数据转换类时也不得不修改CustomerDAO的源代码，系统扩展性较差，违反了开闭原则，现需要对该方案进行重构。</p> <p>在本实例中，由于CustomerDAO针对具体数据转换类编程，因此在增加新的数据转换类或者更换数据转换类时都不得不修改CustomerDAO的源代码。我们可以通过引入抽象数据转换类解决该问题，在引入抽象数据转换类DataConvertor之后，CustomerDAO针对抽象类DataConvertor编程，而将具体数据转换类名存储在配置文件中，符合依赖倒转原则。根据里氏代换原则，程序运行时，具体数据转换类对象将替换DataConvertor类型的对象，程序不会出现任何问题。更换具体数据转换类时无须修改源代码，只需要修改配置文件；如果需要增加新的具体数据转换类，只要将新增数据转换类作为DataConvertor的子类并修改配置文件即可，原有代码无须做任何修改，满足开闭原则。重构后的结构如图2所示：</p> <p><img src="/assets/img/s8.8db863af.jpg" alt=""></p> <p>图2重构后的结构图</p> <p>在上述重构过程中，我们使用了开闭原则、里氏代换原则和依赖倒转原则，在大多数情况下，这三个设计原则会同时出现，开闭原则是目标，里氏代换原则是基础，依赖倒转原则是手段，它们相辅相成，相互补充，目标一致，只是分析问题时所站角度不同而已。</p> <h3 id="接口隔离"><a href="#接口隔离" class="header-anchor">#</a> 接口隔离</h3> <p>接口隔离原则(Interface Segregation Principle, ISP)：使用多个专门的接口，而不使用单一的总接口，即客户端不应该依赖那些它不需要的接口。</p> <p>根据接口隔离原则，当一个接口太大时，我们需要将它分割成一些更细小的接口，使用该接口的客户端仅需知道与之相关的方法即可。每一个接口应该承担一种相对独立的角色，不干不该干的事，该干的事都要干。这里的“接口”往往有两种不同的含义：一种是指一个类型所具有的方法特征的集合，仅仅是一种逻辑上的抽象；另外一种是指某种语言具体的“接口”定义，有严格的定义和结构，比如Java语言中的interface。对于这两种不同的含义，ISP的表达方式以及含义都有所不同：</p> <p>(1) 当把“接口”理解成一个类型所提供的所有方法特征的集合的时候，这就是一种逻辑上的概念，接口的划分将直接带来类型的划分。可以把接口理解成角色，一个接口只能代表一个角色，每个角色都有它特定的一个接口，此时，这个原则可以叫做“角色隔离原则”。</p> <p>(2) 如果把“接口”理解成狭义的特定语言的接口，那么ISP表达的意思是指接口仅仅提供客户端需要的行为，客户端不需要的行为则隐藏起来，应当为客户端提供尽可能小的单独的接口，而不要提供大的总接口。在面向对象编程语言中，实现一个接口就需要实现该接口中定义的所有方法，因此大的总接口使用起来不一定很方便，为了使接口的职责单一，需要将大接口中的方法根据其职责不同分别放在不同的小接口中，以确保每个接口使用起来都较为方便，并都承担某一单一角色。接口应该尽量细化，同时接口中的方法应该尽量少，每个接口中只包含一个客户端（如子模块或业务逻辑类）所需的方法即可，这种机制也称为“定制服务”，即为不同的客户端提供宽窄不同的接口。</p> <p>下面通过一个简单实例来加深对接口隔离原则的理解：</p> <div class="language- extra-class"><pre><code>  Sunny软件公司开发人员针对某CRM系统的客户数据显示模块设计了如图1所示接口，其中方法dataRead()用于从文件中读取数据，方法transformToXML()用于将数据转换成XML格式，方法createChart()用于创建图表，方法displayChart()用于显示图表，方法createReport()用于创建文字报表，方法displayReport()用于显示文字报表。
</code></pre></div><p><img src="/assets/img/s9.a8e92506.jpg" alt=""></p> <p>图1 初始设计方案结构图</p> <p>在实际使用过程中发现该接口很不灵活，例如如果一个具体的数据显示类无须进行数据转换（源文件本身就是XML格式），但由于实现了该接口，将不得不实现其中声明的transformToXML()方法（至少需要提供一个空实现）；如果需要创建和显示图表，除了需实现与图表相关的方法外，还需要实现创建和显示文字报表的方法，否则程序编译时将报错。</p> <p>现使用接口隔离原则对其进行重构。</p> <p>在图1中，由于在接口CustomerDataDisplay中定义了太多方法，即该接口承担了太多职责，一方面导致该接口的实现类很庞大，在不同的实现类中都不得不实现接口中定义的所有方法，灵活性较差，如果出现大量的空方法，将导致系统中产生大量的无用代码，影响代码质量；另一方面由于客户端针对大接口编程，将在一定程序上破坏程序的封装性，客户端看到了不应该看到的方法，没有为客户端定制接口。因此需要将该接口按照接口隔离原则和单一职责原则进行重构，将其中的一些方法封装在不同的小接口中，确保每一个接口使用起来都较为方便，并都承担某一单一角色，每个接口中只包含一个客户端（如模块或类）所需的方法即可。</p> <p>通过使用接口隔离原则，本实例重构后的结构如图2所示：</p> <p><img src="/assets/img/s10.92f1b083.jpg" alt=""></p> <p>图2 重构后的结构图</p> <p>在使用接口隔离原则时，我们需要注意控制接口的粒度，接口不能太小，如果太小会导致系统中接口泛滥，不利于维护；接口也不能太大，太大的接口将违背接口隔离原则，灵活性较差，使用起来很不方便。一般而言，接口中仅包含为某一类用户定制的方法即可，不应该强迫客户依赖于那些它们不用的方法。</p> <h3 id="合成复用"><a href="#合成复用" class="header-anchor">#</a> 合成复用</h3> <p>合成复用原则(Composite Reuse Principle, CRP)：尽量使用对象组合，而不是继承来达到复用的目的。</p> <p>合成复用原则就是在一个新的对象里通过关联关系（包括组合关系和聚合关系）来使用一些已有的对象，使之成为新对象的一部分；新对象通过委派调用已有对象的方法达到复用功能的目的。简言之：复用时要尽量使用组合/聚合关系（关联关系），少用继承。</p> <p>在面向对象设计中，可以通过两种方法在不同的环境中复用已有的设计和实现，即通过组合/聚合关系或通过继承，但首先应该考虑使用组合/聚合，组合/聚合可以使系统更加灵活，降低类与类之间的耦合度，一个类的变化对其他类造成的影响相对较少；其次才考虑继承，在使用继承时，需要严格遵循里氏代换原则，有效使用继承会有助于对问题的理解，降低复杂度，而滥用继承反而会增加系统构建和维护的难度以及系统的复杂度，因此需要慎重使用继承复用。</p> <p>通过继承来进行复用的主要问题在于继承复用会破坏系统的封装性，因为继承会将基类的实现细节暴露给子类，由于基类的内部细节通常对子类来说是可见的，所以这种复用又称“白箱”复用，如果基类发生改变，那么子类的实现也不得不发生改变；从基类继承而来的实现是静态的，不可能在运行时发生改变，没有足够的灵活性；而且继承只能在有限的环境中使用（如类没有声明为不能被继承）。</p> <p>由于组合或聚合关系可以将已有的对象（也可称为成员对象）纳入到新对象中，使之成为新对象的一部分，因此新对象可以调用已有对象的功能，这样做可以使得成员对象的内部实现细节对于新对象不可见，所以这种复用又称为“黑箱”复用，相对继承关系而言，其耦合度相对较低，成员对象的变化对新对象的影响不大，可以在新对象中根据实际需要有选择性地调用成员对象的操作；合成复用可以在运行时动态进行，新对象可以动态地引用与成员对象类型相同的其他对象。</p> <p>一般而言，如果两个类之间是“Has-A”的关系应使用组合或聚合，如果是“Is-A”关系可使用继承。&quot;Is-A&quot;是严格的分类学意义上的定义，意思是一个类是另一个类的&quot;一种&quot;；而&quot;Has-A&quot;则不同，它表示某一个角色具有某一项责任。</p> <p>下面通过一个简单实例来加深对合成复用原则的理解：</p> <p>Sunny软件公司开发人员在初期的CRM系统设计中，考虑到客户数量不多，系统采用MySQL作为数据库，与数据库操作有关的类如CustomerDAO类等都需要连接数据库，连接数据库的方法getConnection()封装在DBUtil类中，由于需要重用DBUtil类的getConnection()方法，设计人员将CustomerDAO作为DBUtil类的子类，初始设计方案结构如图1所示：</p> <p><img src="/assets/img/s11.12b9d7f5.jpg" alt=""></p> <p>图1  初始设计方案结构图</p> <p>随着客户数量的增加，系统决定升级为Oracle数据库，因此需要增加一个新的OracleDBUtil类来连接Oracle数据库，由于在初始设计方案中CustomerDAO和DBUtil之间是继承关系，因此在更换数据库连接方式时需要修改CustomerDAO类的源代码，将CustomerDAO作为OracleDBUtil的子类，这将违反开闭原则。【当然也可以修改DBUtil类的源代码，同样会违反开闭原则。】</p> <p>现使用合成复用原则对其进行重构。</p> <p>根据合成复用原则，我们在实现复用时应该多用关联，少用继承。因此在本实例中我们可以使用关联复用来取代继承复用，重构后的结构如图2所示：</p> <p><img src="/assets/img/s12.106f76d3.jpg" alt=""></p> <p>图2  重构后的结构图</p> <p>在图2中，CustomerDAO和DBUtil之间的关系由继承关系变为关联关系，采用依赖注入的方式将DBUtil对象注入到CustomerDAO中，可以使用构造注入，也可以使用Setter注入。如果需要对DBUtil的功能进行扩展，可以通过其子类来实现，如通过子类OracleDBUtil来连接Oracle数据库。由于CustomerDAO针对DBUtil编程，根据里氏代换原则，DBUtil子类的对象可以覆盖DBUtil对象，只需在CustomerDAO中注入子类对象即可使用子类所扩展的方法。例如在CustomerDAO中注入OracleDBUtil对象，即可实现Oracle数据库连接，原有代码无须进行修改，而且还可以很灵活地增加新的数据库连接方式。</p> <h3 id="迪米特法则"><a href="#迪米特法则" class="header-anchor">#</a> 迪米特法则</h3> <p>迪米特法则来自于1987年美国东北大学(Northeastern University)一个名为“Demeter”的研究项目。迪米特法则又称为最少知识原则(LeastKnowledge Principle, LKP)，其定义如下：</p> <p>迪米特法则(Law of  Demeter, LoD)：一个软件实体应当尽可能少地与其他实体发生相互作用。</p> <p>如果一个系统符合迪米特法则，那么当其中某一个模块发生修改时，就会尽量少地影响其他模块，扩展会相对容易，这是对软件实体之间通信的限制，迪米特法则要求限制软件实体之间通信的宽度和深度。迪米特法则可降低系统的耦合度，使类与类之间保持松散的耦合关系。</p> <p>迪米特法则还有几种定义形式，包括：不要和“陌生人”说话、只与你的直接朋友通信等，在迪米特法则中，对于一个对象，其朋友包括以下几类：</p> <div class="language- extra-class"><pre><code>  (1) 当前对象本身(this)；

  (2) 以参数形式传入到当前对象方法中的对象；

  (3) 当前对象的成员对象；

  (4) 如果当前对象的成员对象是一个集合，那么集合中的元素也都是朋友；

  (5) 当前对象所创建的对象。
</code></pre></div><p>任何一个对象，如果满足上面的条件之一，就是当前对象的“朋友”，否则就是“陌生人”。在应用迪米特法则时，一个对象只能与直接朋友发生交互，不要与“陌生人”发生直接交互，这样做可以降低系统的耦合度，一个对象的改变不会给太多其他对象带来影响。</p> <p>迪米特法则要求我们在设计系统时，应该尽量减少对象之间的交互，如果两个对象之间不必彼此直接通信，那么这两个对象就不应当发生任何直接的相互作用，如果其中的一个对象需要调用另一个对象的某一个方法的话，可以通过第三者转发这个调用。简言之，就是通过引入一个合理的第三者来降低现有对象之间的耦合度。</p> <p>在将迪米特法则运用到系统设计中时，要注意下面的几点：在类的划分上，应当尽量创建松耦合的类，类之间的耦合度越低，就越有利于复用，一个处在松耦合中的类一旦被修改，不会对关联的类造成太大波及；在类的结构设计上，每一个类都应当尽量降低其成员变量和成员函数的访问权限；在类的设计上，只要有可能，一个类型应当设计成不变类；在对其他类的引用上，一个对象对其他对象的引用应当降到最低。</p> <p>下面通过一个简单实例来加深对迪米特法则的理解：</p> <p>Sunny软件公司所开发CRM系统包含很多业务操作窗口，在这些窗口中，某些界面控件之间存在复杂的交互关系，一个控件事件的触发将导致多个其他界面控件产生响应，例如，当一个按钮(Button)被单击时，对应的列表框(List)、组合框(ComboBox)、文本框(TextBox)、文本标签(Label)等都将发生改变，在初始设计方案中，界面控件之间的交互关系可简化为如图1所示结构：</p> <p><img src="/assets/img/s13.efbaadde.jpg" alt=""></p> <p>图1 初始设计方案结构图</p> <p>在图1中，由于界面控件之间的交互关系复杂，导致在该窗口中增加新的界面控件时需要修改与之交互的其他控件的源代码，系统扩展性较差，也不便于增加和删除新控件。</p> <p>现使用迪米特对其进行重构。</p> <p>在本实例中，可以通过引入一个专门用于控制界面控件交互的中间类(Mediator)来降低界面控件之间的耦合度。引入中间类之后，界面控件之间不再发生直接引用，而是将请求先转发给中间类，再由中间类来完成对其他控件的调用。当需要增加或删除新的控件时，只需修改中间类即可，无须修改新增控件或已有控件的源代码，重构后结构如图2所示：</p> <p><img src="/assets/img/s14.d3f8987a.jpg" alt=""></p> <p>图2  重构后的结构图</p> <h2 id="创建型模式"><a href="#创建型模式" class="header-anchor">#</a> 创建型模式</h2> <h3 id="简单工厂"><a href="#简单工厂" class="header-anchor">#</a> 简单工厂</h3> <p>工厂模式是最常用的一类创建型设计模式，通常我们所说的工厂模式是指工厂方法模式，它也是使用频率最高的工厂模式。本章将要学习的简单工厂模式是工厂方法模式的“小弟”，它不属于GoF 23种设计模式，但在软件开发中应用也较为频繁，通常将它作为学习其他工厂模式的入门。此外，工厂方法模式还有一位“大哥”——抽象工厂模式。这三种工厂模式各具特色，难度也逐个加大，在软件开发中它们都得到了广泛的应用，成为面向对象软件中常用的创建对象的工具。</p> <h4 id="_1-图表库的设计"><a href="#_1-图表库的设计" class="header-anchor">#</a> 1 图表库的设计</h4> <p>​       Sunny软件公司欲基于Java语言开发一套图表库，该图表库可以为应用系统提供各种不同外观的图表，例如柱状图、饼状图、折线图等。Sunny软件公司图表库设计人员希望为应用系统开发人员提供一套灵活易用的图表库，而且可以较为方便地对图表库进行扩展，以便能够在将来增加一些新类型的图表。</p> <p>Sunny软件公司图表库设计人员提出了一个初始设计方案，将所有图表的实现代码封装在一个Chart类中，其框架代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Chart</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span> <span class="token comment">//图表类型</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Chart</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;histogram&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//初始化柱状图</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;pie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//初始化饼状图</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//初始化折线图</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	 
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;histogram&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//显示柱状图</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;pie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//显示饼状图</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//显示折线图</span>
		<span class="token punctuation">}</span>	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>客户端代码通过调用Chart类的构造函数来创建图表对象，根据参数type的不同可以得到不同类型的图表，然后再调用display()方法来显示相应的图表。</p> <p>不难看出，Chart类是一个“巨大的”类，在该类的设计中存在如下几个问题：</p> <p>(1) 在Chart类中包含很多“if…else…”代码块，整个类的代码相当冗长，代码越长，阅读难度、维护难度和测试难度也越大；而且大量条件语句的存在还将影响系统的性能，程序在执行过程中需要做大量的条件判断。</p> <p>(2) Chart类的职责过重，它负责初始化和显示所有的图表对象，将各种图表对象的初始化代码和显示代码集中在一个类中实现，违反了“单一职责原则”，不利于类的重用和维护；而且将大量的对象初始化代码都写在构造函数中将导致构造函数非常庞大，对象在创建时需要进行条件判断，降低了对象创建的效率。</p> <p>(3) 当需要增加新类型的图表时，必须修改Chart类的源代码，违反了“开闭原则”。</p> <p>(4) 客户端只能通过new关键字来直接创建Chart对象，Chart类与客户端类耦合度较高，对象的创建和使用无法分离。</p> <p>(5) 客户端在创建Chart对象之前可能还需要进行大量初始化设置，例如设置柱状图的颜色、高度等，如果在Chart类的构造函数中没有提供一个默认设置，那就只能由客户端来完成初始设置，这些代码在每次创建Chart对象时都会出现，导致代码的重复。</p> <p>面对一个如此巨大、职责如此重，且与客户端代码耦合度非常高的类，我们应该怎么办？本章将要介绍的简单工厂模式将在一定程度上解决上述问题。</p> <h4 id="_2-简单工厂模式概述"><a href="#_2-简单工厂模式概述" class="header-anchor">#</a> 2 简单工厂模式概述</h4> <p>​       简单工厂模式并不属于GoF 23个经典设计模式，但通常将它作为学习其他工厂模式的基础，它的设计思想很简单，其基本流程如下：</p> <p>首先将需要创建的各种不同对象（例如各种不同的Chart对象）的相关代码封装到不同的类中，这些类称为具体产品类，而将它们公共的代码进行抽象和提取后封装在一个抽象产品类中，每一个具体产品类都是抽象产品类的子类；然后提供一个工厂类用于创建各种产品，在工厂类中提供一个创建产品的工厂方法，该方法可以根据所传入的参数不同创建不同的具体产品对象；客户端只需调用工厂类的工厂方法并传入相应的参数即可得到一个产品对象。</p> <p>简单工厂模式定义如下：</p> <p>简单工厂模式(Simple Factory Pattern)：定义一个工厂类，它可以根据参数的不同返回不同类的实例，被创建的实例通常都具有共同的父类。因为在简单工厂模式中用于创建实例的方法是静态(static)方法，因此简单工厂模式又被称为静态工厂方法(Static Factory Method)模式，它属于类创建型模式。</p> <p>简单工厂模式的要点在于：当你需要什么，只需要传入一个正确的参数，就可以获取你所需要的对象，而无须知道其创建细节。简单工厂模式结构比较简单，其核心是工厂类的设计，其结构如图1所示：</p> <p><img src="/assets/img/s15.e377f3d7.jpg" alt=""></p> <p>图1  简单工厂模式结构图</p> <p>在简单工厂模式结构图中包含如下几个角色：</p> <p>● Factory（工厂角色）：工厂角色即工厂类，它是简单工厂模式的核心，负责实现创建所有产品实例的内部逻辑；工厂类可以被外界直接调用，创建所需的产品对象；在工厂类中提供了静态的工厂方法factoryMethod()，它的返回类型为抽象产品类型Product。</p> <p>● Product（抽象产品角色）：它是工厂类所创建的所有对象的父类，封装了各种产品对象的公有方法，它的引入将提高系统的灵活性，使得在工厂类中只需定义一个通用的工厂方法，因为所有创建的具体产品对象都是其子类对象。</p> <p>● ConcreteProduct（具体产品角色）：它是简单工厂模式的创建目标，所有被创建的对象都充当这个角色的某个具体类的实例。每一个具体产品角色都继承了抽象产品角色，需要实现在抽象产品中声明的抽象方法。</p> <p>在简单工厂模式中，客户端通过工厂类来创建一个产品类的实例，而无须直接使用new关键字来创建对象，它是工厂模式家族中最简单的一员。</p> <p>在使用简单工厂模式时，首先需要对产品类进行重构，不能设计一个包罗万象的产品类，而需根据实际情况设计一个产品层次结构，将所有产品类公共的代码移至抽象产品类，并在抽象产品类中声明一些抽象方法，以供不同的具体产品类来实现，典型的抽象产品类代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token comment">//所有产品类的公共业务方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodSame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//公共方法的实现</span>
    <span class="token punctuation">}</span>
<span class="token comment">//声明抽象业务方法</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">methodDiff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>​       在具体产品类中实现了抽象产品类中声明的抽象业务方法，不同的具体产品类可以提供不同的实现，典型的具体产品类代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ConcreteProduct</span> <span class="token keyword">extends</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token comment">//实现业务方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodDiff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//业务方法的实现</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​       简单工厂模式的核心是工厂类，在没有工厂类之前，客户端一般会使用new关键字来直接创建产品对象，而在引入工厂类之后，客户端可以通过工厂类来创建产品，在简单工厂模式中，工厂类提供了一个静态工厂方法供客户端使用，根据所传入的参数不同可以创建不同的产品对象，典型的工厂类代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token comment">//静态工厂方法</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Product</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化设置product</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化设置product</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> product<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>​       在客户端代码中，我们通过调用工厂类的工厂方法即可得到产品对象，典型代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Product</span> product<span class="token punctuation">;</span> 
		product <span class="token operator">=</span> <span class="token class-name">Factory</span><span class="token punctuation">.</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过工厂类创建产品对象</span>
		product<span class="token punctuation">.</span><span class="token function">methodSame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		product<span class="token punctuation">.</span><span class="token function">methodDiff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_3-完整解决方案"><a href="#_3-完整解决方案" class="header-anchor">#</a> 3 完整解决方案</h4> <p>​    为了将Chart类的职责分离，同时将Chart对象的创建和使用分离，Sunny软件公司开发人员决定使用简单工厂模式对图表库进行重构，重构后的结构如图2所示：</p> <p><img src="/assets/img/s16.834f6611.jpg" alt=""></p> <p>在图2中，Chart接口充当抽象产品类，其子类HistogramChart、PieChart和LineChart充当具体产品类，ChartFactory充当工厂类。完整代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//抽象图表接口：抽象产品类</span>
<span class="token keyword">interface</span> <span class="token class-name">Chart</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//柱状图类：具体产品类</span>
<span class="token keyword">class</span> <span class="token class-name">HistogramChart</span> <span class="token keyword">implements</span> <span class="token class-name">Chart</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">HistogramChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;创建柱状图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示柱状图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//饼状图类：具体产品类</span>
<span class="token keyword">class</span> <span class="token class-name">PieChart</span> <span class="token keyword">implements</span> <span class="token class-name">Chart</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">PieChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;创建饼状图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示饼状图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//折线图类：具体产品类</span>
<span class="token keyword">class</span> <span class="token class-name">LineChart</span> <span class="token keyword">implements</span> <span class="token class-name">Chart</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">LineChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;创建折线图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示折线图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//图表工厂类：工厂类</span>
<span class="token keyword">class</span> <span class="token class-name">ChartFactory</span> <span class="token punctuation">{</span>
    <span class="token comment">//静态工厂方法</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Chart</span> <span class="token function">getChart</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Chart</span> chart <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;histogram&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			chart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HistogramChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始化设置柱状图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;pie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			chart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PieChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始化设置饼状图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;line&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			chart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LineChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始化设置折线图！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> chart<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>编写如下客户端测试代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Chart</span> chart<span class="token punctuation">;</span>
		chart <span class="token operator">=</span> <span class="token class-name">ChartFactory</span><span class="token punctuation">.</span><span class="token function">getChart</span><span class="token punctuation">(</span><span class="token string">&quot;histogram&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过静态工厂方法创建产品</span>
		chart<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>编译并运行程序，输出结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>创建柱状图！

初始化设置柱状图！

显示柱状图！

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在客户端测试类中，我们使用工厂类的静态工厂方法创建产品对象，如果需要更换产品，只需修改静态工厂方法中的参数即可，例如将柱状图改为饼状图，只需将代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>chart <span class="token operator">=</span> <span class="token class-name">ChartFactory</span><span class="token punctuation">.</span><span class="token function">getChart</span><span class="token punctuation">(</span><span class="token string">&quot;histogram&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>改为</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>chart <span class="token operator">=</span> <span class="token class-name">ChartFactory</span><span class="token punctuation">.</span><span class="token function">getChart</span><span class="token punctuation">(</span><span class="token string">&quot;pie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>创建饼状图！

初始化设置饼状图！

显示饼状图！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_4-方案的改进"><a href="#_4-方案的改进" class="header-anchor">#</a> 4 方案的改进</h4> <p>​       Sunny软件公司开发人员发现在创建具体Chart对象时，每更换一个Chart对象都需要修改客户端代码中静态工厂方法的参数，客户端代码将要重新编译，这对于客户端而言，违反了“开闭原则”，有没有一种方法能够在不修改客户端代码的前提下更换具体产品对象呢？答案是肯定的，下面将介绍一种常用的实现方式。</p> <p>我们可以将静态工厂方法的参数存储在XML或properties格式的配置文件中，如下config.xml所示：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chartType</span><span class="token punctuation">&gt;</span></span>histogram<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chartType</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>通过xmlutils读取</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>w3c<span class="token punctuation">.</span>dom<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>sax<span class="token punctuation">.</span></span><span class="token class-name">SAXException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLUtil</span> <span class="token punctuation">{</span>
    <span class="token comment">//该方法用于从XML配置文件中提取图表类型，并返回类型名</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getChartType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">//创建文档对象</span>
			<span class="token class-name">DocumentBuilderFactory</span> dFactory <span class="token operator">=</span> <span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">DocumentBuilder</span> builder <span class="token operator">=</span> dFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Document</span> doc<span class="token punctuation">;</span>							
			doc <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
			<span class="token comment">//获取包含图表类型的文本节点</span>
			<span class="token class-name">NodeList</span> nl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;chartType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Node</span> classNode <span class="token operator">=</span> nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> chartType <span class="token operator">=</span> classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> chartType<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>   
       	<span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>客户端代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Chart</span> chart<span class="token punctuation">;</span>
		<span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token class-name">XMLUtil</span><span class="token punctuation">.</span><span class="token function">getChartType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取配置文件中的参数</span>
		chart <span class="token operator">=</span> <span class="token class-name">ChartFactory</span><span class="token punctuation">.</span><span class="token function">getChart</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建产品对象</span>
		chart<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果需要更换具体图表对象，只需修改配置文件config.xml，无须修改任何源代码，符合“开闭原则”。</p> <h4 id="_5-简单工厂模式的简化"><a href="#_5-简单工厂模式的简化" class="header-anchor">#</a> 5 简单工厂模式的简化</h4> <p>有时候，为了简化简单工厂模式，我们可以将抽象产品类和工厂类合并，将静态工厂方法移至抽象产品类中，如图3所示：</p> <p><img src="/assets/img/s17.4f7a8742.jpg" alt=""></p> <p>图3 简化的简单工厂模式</p> <p>在图3中，客户端可以通过产品父类的静态工厂方法，根据参数的不同创建不同类型的产品子类对象，这种做法在JDK等类库和框架中也广泛存在。</p> <h4 id="_6-简单工厂模式总结"><a href="#_6-简单工厂模式总结" class="header-anchor">#</a> 6 简单工厂模式总结</h4> <p>​      简单工厂模式提供了专门的工厂类用于创建对象，将对象的创建和对象的使用分离开，它作为一种最简单的工厂模式在软件开发中得到了较为广泛的应用。</p> <ol><li><p>主要优点</p> <p>简单工厂模式的主要优点如下：</p> <p>(1) 工厂类包含必要的判断逻辑，可以决定在什么时候创建哪一个产品类的实例，客户端可以免除直接创建产品对象的职责，而仅仅“消费”产品，简单工厂模式实现了对象创建和使用的分离。</p> <p>(2) 客户端无须知道所创建的具体产品类的类名，只需要知道具体产品类所对应的参数即可，对于一些复杂的类名，通过简单工厂模式可以在一定程度减少使用者的记忆量。</p> <p>(3) 通过引入配置文件，可以在不修改任何客户端代码的情况下更换和增加新的具体产品类，在一定程度上提高了系统的灵活性。</p></li> <li><p>主要缺点</p> <p>简单工厂模式的主要缺点如下：</p> <p>(1) 由于工厂类集中了所有产品的创建逻辑，职责过重，一旦不能正常工作，整个系统都要受到影响。</p> <p>(2) 使用简单工厂模式势必会增加系统中类的个数（引入了新的工厂类），增加了系统的复杂度和理解难度。</p> <p>(3) 系统扩展困难，一旦添加新产品就不得不修改工厂逻辑，在产品类型较多时，有可能造成工厂逻辑过于复杂，不利于系统的扩展和维护。</p> <p>(4) 简单工厂模式由于使用了静态工厂方法，造成工厂角色无法形成基于继承的等级结构。</p></li> <li><p>适用场景</p> <p>在以下情况下可以考虑使用简单工厂模式：</p> <p>(1) 工厂类负责创建的对象比较少，由于创建的对象较少，不会造成工厂方法中的业务逻辑太过复杂。</p> <p>(2) 客户端只知道传入工厂类的参数，对于如何创建对象并不关心。</p></li></ol> <h3 id="抽象工厂"><a href="#抽象工厂" class="header-anchor">#</a> 抽象工厂</h3> <h4 id="_1-界面皮肤库的初始设计"><a href="#_1-界面皮肤库的初始设计" class="header-anchor">#</a> 1 界面皮肤库的初始设计</h4> <p>​       Sunny软件公司欲开发一套界面皮肤库，可以对Java桌面软件进行界面美化。为了保护版权，该皮肤库源代码不打算公开，而只向用户提供已打包为jar文件的class字节码文件。用户在使用时可以通过菜单来选择皮肤，不同的皮肤将提供视觉效果不同的按钮、文本框、组合框等界面元素，其结构示意图如图1所示：</p> <p><img src="/assets/img/s18.65927dee.jpg" alt=""></p> <p>图1 界面皮肤库结构示意图</p> <p>该皮肤库需要具备良好的灵活性和可扩展性，用户可以自由选择不同的皮肤，开发人员可以在不修改既有代码的基础上增加新的皮肤。</p> <p>Sunny软件公司的开发人员针对上述要求，决定使用工厂方法模式进行系统的设计，为了保证系统的灵活性和可扩展性，提供一系列具体工厂来创建按钮、文本框、组合框等界面元素，客户端针对抽象工厂编程，初始结构如图2所示：</p> <p><img src="/assets/img/s19.da8d07b2.jpg" alt=""></p> <p>图2 基于工厂方法模式的界面皮肤库初始结构图</p> <p>在图2中，提供了大量工厂来创建具体的界面组件，可以通过配置文件更换具体界面组件从而改变界面风格。但是，此设计方案存在如下问题：</p> <p>(1) 当需要增加新的皮肤时，虽然不要修改现有代码，但是需要增加大量类，针对每一个新增具体组件都需要增加一个具体工厂，类的个数成对增加，这无疑会导致系统越来越庞大，增加系统的维护成本和运行开销；</p> <p>(2) 由于同一种风格的具体界面组件通常要一起显示，因此需要为每个组件都选择一个具体工厂，用户在使用时必须逐个进行设置，如果某个具体工厂选择失误将会导致界面显示混乱，虽然我们可以适当增加一些约束语句，但客户端代码和配置文件都较为复杂。</p> <p>如何减少系统中类的个数并保证客户端每次始终只使用某一种风格的具体界面组件？这是Sunny公司开发人员所面临的两个问题，显然，工厂方法模式无法解决这两个问题</p> <h4 id="_2-产品等级结构与产品族"><a href="#_2-产品等级结构与产品族" class="header-anchor">#</a> 2 产品等级结构与产品族</h4> <p>​       在工厂方法模式中具体工厂负责生产具体的产品，每一个具体工厂对应一种具体产品，工厂方法具有唯一性，一般情况下，一个具体工厂中只有一个或者一组重载的工厂方法。但是有时候我们希望一个工厂可以提供多个产品对象，而不是单一的产品对象，如一个电器工厂，它可以生产电视机、电冰箱、空调等多种电器，而不是只生产某一种电器。为了更好地理解抽象工厂模式，我们先引入两个概念：</p> <p>(1) 产品等级结构：产品等级结构即产品的继承结构，如一个抽象类是电视机，其子类有海尔电视机、海信电视机、TCL电视机，则抽象电视机与具体品牌的电视机之间构成了一个产品等级结构，抽象电视机是父类，而具体品牌的电视机是其子类。</p> <p>(2) 产品族：在抽象工厂模式中，产品族是指由同一个工厂生产的，位于不同产品等级结构中的一组产品，如海尔电器工厂生产的海尔电视机、海尔电冰箱，海尔电视机位于电视机产品等级结构中，海尔电冰箱位于电冰箱产品等级结构中，海尔电视机、海尔电冰箱构成了一个产品族。</p> <p>产品等级结构与产品族示意图如图3所示：</p> <p><img src="/assets/img/s20.cfe2f5f8.jpg" alt=""></p> <p>图3  产品族与产品等级结构示意图</p> <p>在图3中，不同颜色的多个正方形、圆形和椭圆形分别构成了三个不同的产品等级结构，而相同颜色的正方形、圆形和椭圆形构成了一个产品族，每一个形状对象都位于某个产品族，并属于某个产品等级结构。图3中一共有五个产品族，分属于三个不同的产品等级结构。我们只要指明一个产品所处的产品族以及它所属的等级结构，就可以唯一确定这个产品。</p> <p>当系统所提供的工厂生产的具体产品并不是一个简单的对象，而是多个位于不同产品等级结构、属于不同类型的具体产品时就可以使用抽象工厂模式。抽象工厂模式是所有形式的工厂模式中最为抽象和最具一般性的一种形式。抽象工厂模式与工厂方法模式最大的区别在于，工厂方法模式针对的是一个产品等级结构，而抽象工厂模式需要面对多个产品等级结构，一个工厂等级结构可以负责多个不同产品等级结构中的产品对象的创建。当一个工厂等级结构可以创建出分属于不同产品等级结构的一个产品族中的所有对象时，抽象工厂模式比工厂方法模式更为简单、更有效率。抽象工厂模式示意图如图4所示：</p> <p><img src="/assets/img/s21.209baf3b.jpg" alt=""></p> <p>图4 抽象工厂模式示意图</p> <p>在图4中，每一个具体工厂可以生产属于一个产品族的所有产品，例如生产颜色相同的正方形、圆形和椭圆形，所生产的产品又位于不同的产品等级结构中。如果使用工厂方法模式，图4所示结构需要提供15个具体工厂，而使用抽象工厂模式只需要提供5个具体工厂，极大减少了系统中类的个数。</p> <h4 id="_3-抽象工厂模式概述"><a href="#_3-抽象工厂模式概述" class="header-anchor">#</a> 3 抽象工厂模式概述</h4> <p>​       抽象工厂模式为创建一组对象提供了一种解决方案。与工厂方法模式相比，抽象工厂模式中的具体工厂不只是创建一种产品，它负责创建一族产品。抽象工厂模式定义如下：</p> <div class="language- extra-class"><pre><code>   抽象工厂模式(Abstract Factory Pattern)：提供一个创建一系列相关或相互依赖对象的接口，而无须指定它们具体的类。抽象工厂模式又称为Kit模式，它是一种对象创建型模式。

   在抽象工厂模式中，每一个具体工厂都提供了多个工厂方法用于产生多种不同类型的产品，这些产品构成了一个产品族，抽象工厂模式结构如图5所示：
</code></pre></div><p><img src="/assets/img/s22.7f0467ff.jpg" alt=""></p> <p>图5  抽象工厂模式结构图</p> <p>在抽象工厂模式结构图中包含如下几个角色：</p> <p>● AbstractFactory（抽象工厂）：它声明了一组用于创建一族产品的方法，每一个方法对应一种产品。</p> <p>● ConcreteFactory（具体工厂）：它实现了在抽象工厂中声明的创建产品的方法，生成一组具体产品，这些产品构成了一个产品族，每一个产品都位于某个产品等级结构中。</p> <p>● AbstractProduct（抽象产品）：它为每种产品声明接口，在抽象产品中声明了产品所具有的业务方法。</p> <p>● ConcreteProduct（具体产品）：它定义具体工厂生产的具体产品对象，实现抽象产品接口中声明的业务方法。</p> <p>在抽象工厂中声明了多个工厂方法，用于创建不同类型的产品，抽象工厂可以是接口，也可以是抽象类或者具体类，其典型代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractFactory</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">AbstractProductA</span> <span class="token function">createProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//工厂方法一</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">AbstractProductB</span> <span class="token function">createProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//工厂方法二</span>
……
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​       具体工厂实现了抽象工厂，每一个具体的工厂方法可以返回一个特定的产品对象，而同一个具体工厂所创建的产品对象构成了一个产品族。对于每一个具体工厂类，其典型代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ConcreteFactory1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractFactory</span> <span class="token punctuation">{</span>
    <span class="token comment">//工厂方法一</span>
<span class="token keyword">public</span> <span class="token class-name">AbstractProductA</span> <span class="token function">createProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteProductA1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//工厂方法二</span>
<span class="token keyword">public</span> <span class="token class-name">AbstractProductB</span> <span class="token function">createProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteProductB1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

……
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>​       与工厂方法模式一样，抽象工厂模式也可为每一种产品提供一组重载的工厂方法，以不同的方式对产品对象进行创建。</p> <h4 id="_4-完整解决方案"><a href="#_4-完整解决方案" class="header-anchor">#</a> 4 完整解决方案</h4> <p>​       Sunny公司开发人员使用抽象工厂模式来重构界面皮肤库的设计，其基本结构如图6所示：</p> <p><img src="/assets/img/s23.3e9f0517.jpg" alt=""></p> <p>图6 界面皮肤库结构图</p> <p>在图6中，SkinFactory接口充当抽象工厂，其子类SpringSkinFactory和SummerSkinFactory充当具体工厂，接口Button、TextField和ComboBox充当抽象产品，其子类SpringButton、SpringTextField、SpringComboBox和SummerButton、SummerTextField、SummerComboBox充当具体产品。完整代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//在本实例中我们对代码进行了大量简化，实际使用时，界面组件的初始化代码较为复杂，还需要使用JDK中一些已有类，为了突出核心代码，在此只提供框架代码和演示输出。</span>
<span class="token comment">//按钮接口：抽象产品</span>
<span class="token keyword">interface</span> <span class="token class-name">Button</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Spring按钮类：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">SpringButton</span> <span class="token keyword">implements</span> <span class="token class-name">Button</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示浅绿色按钮。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Summer按钮类：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">SummerButton</span> <span class="token keyword">implements</span> <span class="token class-name">Button</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示浅蓝色按钮。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
 
<span class="token comment">//文本框接口：抽象产品</span>
<span class="token keyword">interface</span> <span class="token class-name">TextField</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Spring文本框类：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">SpringTextField</span> <span class="token keyword">implements</span> <span class="token class-name">TextField</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示绿色边框文本框。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Summer文本框类：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">SummerTextField</span> <span class="token keyword">implements</span> <span class="token class-name">TextField</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示蓝色边框文本框。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
 
<span class="token comment">//组合框接口：抽象产品</span>
<span class="token keyword">interface</span> <span class="token class-name">ComboBox</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Spring组合框类：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">SpringComboBox</span> <span class="token keyword">implements</span> <span class="token class-name">ComboBox</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示绿色边框组合框。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Summer组合框类：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">SummerComboBox</span> <span class="token keyword">implements</span> <span class="token class-name">ComboBox</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;显示蓝色边框组合框。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
 
<span class="token comment">//界面皮肤工厂接口：抽象工厂</span>
<span class="token keyword">interface</span> <span class="token class-name">SkinFactory</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">Button</span> <span class="token function">createButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">TextField</span> <span class="token function">createTextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">ComboBox</span> <span class="token function">createComboBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Spring皮肤工厂：具体工厂</span>
<span class="token keyword">class</span> <span class="token class-name">SpringSkinFactory</span> <span class="token keyword">implements</span> <span class="token class-name">SkinFactory</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">Button</span> <span class="token function">createButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token keyword">public</span> <span class="token class-name">TextField</span> <span class="token function">createTextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringTextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token keyword">public</span> <span class="token class-name">ComboBox</span> <span class="token function">createComboBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringComboBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//Summer皮肤工厂：具体工厂</span>
<span class="token keyword">class</span> <span class="token class-name">SummerSkinFactory</span> <span class="token keyword">implements</span> <span class="token class-name">SkinFactory</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">Button</span> <span class="token function">createButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SummerButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token keyword">public</span> <span class="token class-name">TextField</span> <span class="token function">createTextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SummerTextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token keyword">public</span> <span class="token class-name">ComboBox</span> <span class="token function">createComboBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SummerComboBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><p>​       为了让系统具备良好的灵活性和可扩展性，我们引入了工具类XMLUtil和配置文件，其中，XMLUtil类的代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>w3c<span class="token punctuation">.</span>dom<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>sax<span class="token punctuation">.</span></span><span class="token class-name">SAXException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLUtil</span> <span class="token punctuation">{</span>
<span class="token comment">//该方法用于从XML配置文件中提取具体类类名，并返回一个实例对象</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">//创建文档对象</span>
			<span class="token class-name">DocumentBuilderFactory</span> dFactory <span class="token operator">=</span> <span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">DocumentBuilder</span> builder <span class="token operator">=</span> dFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Document</span> doc<span class="token punctuation">;</span>							
			doc <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
			<span class="token comment">//获取包含类名的文本节点</span>
			<span class="token class-name">NodeList</span> nl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Node</span> classNode<span class="token operator">=</span>nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> cName<span class="token operator">=</span>classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">//通过类名生成实例对象并将其返回</span>
            <span class="token class-name">Class</span> c<span class="token operator">=</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  	    <span class="token class-name">Object</span> obj<span class="token operator">=</span>c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>   
        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           	<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
       	<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>​       配置文件config.xml中存储了具体工厂类的类名，代码如下所示：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>className</span><span class="token punctuation">&gt;</span></span>SpringSkinFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>className</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​       编写如下客户端测试代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//使用抽象层定义</span>
		<span class="token class-name">SkinFactory</span> factory<span class="token punctuation">;</span>
		<span class="token class-name">Button</span> bt<span class="token punctuation">;</span>
		<span class="token class-name">TextField</span> tf<span class="token punctuation">;</span>
		<span class="token class-name">ComboBox</span> cb<span class="token punctuation">;</span>
		factory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SkinFactory</span><span class="token punctuation">)</span><span class="token class-name">XMLUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bt <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		tf <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createTextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cb <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createComboBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bt<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		tf<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cb<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>​       编译并运行程序，输出结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>显示浅绿色按钮。

显示绿色边框文本框。

显示绿色边框组合框。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果需要更换皮肤，只需修改配置文件即可，在实际环境中，我们可以提供可视化界面，例如菜单或者窗口来修改配置文件，用户无须直接修改配置文件。如果需要增加新的皮肤，只需增加一族新的具体组件并对应提供一个新的具体工厂，修改配置文件即可使用新的皮肤，原有代码无须修改，符合“开闭原则”。</p> <h4 id="_5-开闭原则-的倾斜性"><a href="#_5-开闭原则-的倾斜性" class="header-anchor">#</a> 5 “开闭原则”的倾斜性</h4> <p>​       Sunny公司使用抽象工厂模式设计了界面皮肤库，该皮肤库可以较为方便地增加新的皮肤，但是现在遇到一个非常严重的问题：由于设计时考虑不全面，忘记为单选按钮(RadioButton)提供不同皮肤的风格化显示，导致无论选择哪种皮肤，单选按钮都显得那么“格格不入”。Sunny公司的设计人员决定向系统中增加单选按钮，但是发现原有系统居然不能够在符合“开闭原则”的前提下增加新的组件，原因是抽象工厂SkinFactory中根本没有提供创建单选按钮的方法，如果需要增加单选按钮，首先需要修改抽象工厂接口SkinFactory，在其中新增声明创建单选按钮的方法，然后逐个修改具体工厂类，增加相应方法以实现在不同的皮肤中创建单选按钮，此外还需要修改客户端，否则单选按钮无法应用于现有系统。</p> <p>怎么办？答案是抽象工厂模式无法解决该问题，这也是抽象工厂模式最大的缺点。在抽象工厂模式中，增加新的产品族很方便，但是增加新的产品等级结构很麻烦，抽象工厂模式的这种性质称为“开闭原则”的倾斜性。“开闭原则”要求系统对扩展开放，对修改封闭，通过扩展达到增强其功能的目的，对于涉及到多个产品族与多个产品等级结构的系统，其功能增强包括两方面：</p> <p>(1) 增加产品族：对于增加新的产品族，抽象工厂模式很好地支持了“开闭原则”，只需要增加具体产品并对应增加一个新的具体工厂，对已有代码无须做任何修改。</p> <p>(2) 增加新的产品等级结构：对于增加新的产品等级结构，需要修改所有的工厂角色，包括抽象工厂类，在所有的工厂类中都需要增加生产新产品的方法，违背了“开闭原则”。</p> <p>正因为抽象工厂模式存在“开闭原则”的倾斜性，它以一种倾斜的方式来满足“开闭原则”，为增加新产品族提供方便，但不能为增加新产品结构提供这样的方便，因此要求设计人员在设计之初就能够全面考虑，不会在设计完成之后向系统中增加新的产品等级结构，也不会删除已有的产品等级结构，否则将会导致系统出现较大的修改，为后续维护工作带来诸多麻烦。</p> <h4 id="_6-抽象工厂模式总结"><a href="#_6-抽象工厂模式总结" class="header-anchor">#</a> 6 抽象工厂模式总结</h4> <p>​       抽象工厂模式是工厂方法模式的进一步延伸，由于它提供了功能更为强大的工厂类并且具备较好的可扩展性，在软件开发中得以广泛应用，尤其是在一些框架和API类库的设计中，例如在Java语言的AWT（抽象窗口工具包）中就使用了抽象工厂模式，它使用抽象工厂模式来实现在不同的操作系统中应用程序呈现与所在操作系统一致的外观界面。抽象工厂模式也是在软件开发中最常用的设计模式之一。</p> <ol><li><p>主要优点</p> <p>抽象工厂模式的主要优点如下：</p> <p>(1) 抽象工厂模式隔离了具体类的生成，使得客户并不需要知道什么被创建。由于这种隔离，更换一个具体工厂就变得相对容易，所有的具体工厂都实现了抽象工厂中定义的那些公共接口，因此只需改变具体工厂的实例，就可以在某种程度上改变整个软件系统的行为。</p> <p>(2) 当一个产品族中的多个对象被设计成一起工作时，它能够保证客户端始终只使用同一个产品族中的对象。</p> <p>(3) 增加新的产品族很方便，无须修改已有系统，符合“开闭原则”。</p> <ol start="2"><li>主要缺点</li></ol> <p>抽象工厂模式的主要缺点如下：</p> <p>增加新的产品等级结构麻烦，需要对原有系统进行较大的修改，甚至需要修改抽象层代码，这显然会带来较大的不便，违背了“开闭原则”。</p> <ol start="3"><li>适用场景</li></ol> <p>在以下情况下可以考虑使用抽象工厂模式：</p> <p>(1) 一个系统不应当依赖于产品类实例如何被创建、组合和表达的细节，这对于所有类型的工厂模式都是很重要的，用户无须关心对象的创建过程，将对象的创建和使用解耦。</p> <p>(2) 系统中有多于一个的产品族，而每次只使用其中某一产品族。可以通过配置文件等方式来使得用户可以动态改变产品族，也可以很方便地增加新的产品族。</p> <p>(3) 属于同一个产品族的产品将在一起使用，这一约束必须在系统的设计中体现出来。同一个产品族中的产品可以是没有任何关系的对象，但是它们都具有一些共同的约束，如同一操作系统下的按钮和文本框，按钮与文本框之间没有直接关系，但它们都是属于某一操作系统的，此时具有一个共同的约束条件：操作系统的类型。</p> <p>(4) 产品等级结构稳定，设计完成之后，不会向系统中增加新的产品等级结构或者删除已有的产品等级结构。</p></li></ol> <h3 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h3> <h4 id="_1-单例模式概述"><a href="#_1-单例模式概述" class="header-anchor">#</a> 1 单例模式概述</h4> <p>​      下面我们来模拟实现Windows任务管理器，假设任务管理器的类名为TaskManager，在TaskManager类中包含了大量的成员方法，例如构造函数TaskManager()，显示进程的方法displayProcesses()，显示服务的方法displayServices()等，该类的示意代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TaskManager</span>
<span class="token punctuation">{</span>
     <span class="token keyword">public</span> <span class="token class-name">TaskManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>……<span class="token punctuation">}</span> <span class="token comment">//初始化窗口</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">displayProcesses</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>……<span class="token punctuation">}</span> <span class="token comment">//显示进程</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">displayServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>……<span class="token punctuation">}</span> <span class="token comment">//显示服务</span>
     ……
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​       为了实现Windows任务管理器的唯一性，我们通过如下三步来对该类进行重构：</p> <p>(1)  由于每次使用new关键字来实例化TaskManager类时都将产生一个新对象，为了确保TaskManager实例的唯一性，我们需要禁止类的外部直接使用new来创建对象，因此需要将TaskManager的构造函数的可见性改为private，如下代码所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">TaskManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>……<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​       (2)  将构造函数改为private修饰后该如何创建对象呢？不要着急，虽然类的外部无法再使用new来创建对象，但是在TaskManager的内部还是可以创建的，可见性只对类外有效。因此，我们可以在TaskManager中创建并保存这个唯一实例。为了让外界可以访问这个唯一实例，需要在TaskManager中定义一个静态的TaskManager类型的私有成员变量，如下代码所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">TaskManager</span> tm <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​      (3)  为了保证成员变量的封装性，我们将TaskManager类型的tm对象的可见性设置为private，但外界该如何使用该成员变量并何时实例化该成员变量呢？答案是增加一个公有的静态方法，如下代码所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">TaskManager</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tm <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        tm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> tm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在getInstance()方法中首先判断tm对象是否存在，如果不存在（即tm == null），则使用new关键字创建一个新的TaskManager类型的tm对象，再返回新创建的tm对象；否则直接返回已有的tm对象。</p> <p>需要注意的是getInstance()方法的修饰符，首先它应该是一个public方法，以便供外界其他对象使用，其次它使用了static关键字，即它是一个静态方法，在类外可以直接通过类名来访问，而无须创建TaskManager对象，事实上在类外也无法创建TaskManager对象，因为构造函数是私有的。</p> <p>通过以上三个步骤，我们完成了一个最简单的单例类的设计，其完整代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TaskManager</span>
<span class="token punctuation">{</span>
     <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">TaskManager</span> tm <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token class-name">TaskManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>……<span class="token punctuation">}</span> <span class="token comment">//初始化窗口</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">displayProcesses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>……<span class="token punctuation">}</span> <span class="token comment">//显示进程</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">displayServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>……<span class="token punctuation">}</span> <span class="token comment">//显示服务</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">TaskManager</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tm <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            tm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> tm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   ……
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在类外我们无法直接创建新的TaskManager对象，但可以通过代码TaskManager.getInstance()来访问实例对象，第一次调用getInstance()方法时将创建唯一实例，再次调用时将返回第一次创建的实例，从而确保实例对象的唯一性。</p> <p>上述代码也是单例模式的一种最典型实现方式，有了以上基础，理解单例模式的定义和结构就非常容易了。单例模式定义如下：</p> <p>单例模式(Singleton Pattern)：确保某一个类只有一个实例，而且自行实例化并向整个系统提供这个实例，这个类称为单例类，它提供全局访问的方法。单例模式是一种对象创建型模式。</p> <p>单例模式有三个要点：一是某个类只能有一个实例；二是它必须自行创建这个实例；三是它必须自行向整个系统提供这个实例。</p> <p>单例模式是结构最简单的设计模式一，在它的核心结构中只包含一个被称为单例类的特殊类。单例模式结构如图3-2所示：</p> <p><img src="data:image/gif;base64,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" alt=""></p> <p>单例模式结构图中只包含一个单例角色：</p> <p>● Singleton（单例）：在单例类的内部实现只生成一个实例，同时它提供一个静态的getInstance()工厂方法，让客户可以访问它的唯一实例；为了防止在外部对其实例化，将其构造函数设计为私有；在单例类内部定义了一个Singleton类型的静态对象，作为外部共享的唯一实例。</p> <h4 id="_2-负载均衡器的设计与实现"><a href="#_2-负载均衡器的设计与实现" class="header-anchor">#</a> 2 负载均衡器的设计与实现</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>     Sunny软件公司承接了一个服务器负载均衡(Load Balance)软件的开发工作，该软件运行在一台负载均衡服务器上，可以将并发访问和数据流量分发到服务器集群中的多台设备上进行并发处理，提高系统的整体处理能力，缩短响应时间。由于集群中的服务器需要动态删减，且客户端请求需要统一分发，因此需要确保负载均衡器的唯一性，只能有一个负载均衡器来负责服务器的管理和请求的分发，否则将会带来服务器状态的不一致以及请求分配冲突等问题。如何确保负载均衡器的唯一性是该软件成功的关键。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Sunny公司开发人员通过分析和权衡，决定使用单例模式来设计该负载均衡器，结构图如图3-3所示：</p> <p><img src="data:image/gif;base64,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" alt=""></p> <p>​    在图3-3中，将负载均衡器LoadBalancer设计为单例类，其中包含一个存储服务器信息的集合serverList，每次在serverList中随机选择一台服务器来响应客户端的请求，实现代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
 
<span class="token comment">//负载均衡器LoadBalancer：单例类，真实环境下该类将非常复杂，包括大量初始化的工作和业务方法，考虑到代码的可读性和易理解性，只列出部分与模式相关的核心代码</span>
<span class="token keyword">class</span> <span class="token class-name">LoadBalancer</span> <span class="token punctuation">{</span>
	<span class="token comment">//私有静态成员变量，存储唯一实例</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LoadBalancer</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token comment">//服务器集合</span>
	<span class="token keyword">private</span> <span class="token class-name">List</span> serverList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	
	<span class="token comment">//私有构造函数</span>
	<span class="token keyword">private</span> <span class="token class-name">LoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		serverList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//公有静态成员方法，返回唯一实例</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LoadBalancer</span> <span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> instance<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//增加服务器</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addServer</span><span class="token punctuation">(</span><span class="token class-name">String</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		serverList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//删除服务器</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeServer</span><span class="token punctuation">(</span><span class="token class-name">String</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		serverList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//使用Random类随机获取服务器</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> i <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>serverList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>serverList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>客户端测试代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建四个LoadBalancer对象</span>
		<span class="token class-name">LoadBalancer</span> balancer1<span class="token punctuation">,</span>balancer2<span class="token punctuation">,</span>balancer3<span class="token punctuation">,</span>balancer4<span class="token punctuation">;</span>
		balancer1 <span class="token operator">=</span> <span class="token class-name">LoadBalancer</span><span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		balancer2 <span class="token operator">=</span> <span class="token class-name">LoadBalancer</span><span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		balancer3 <span class="token operator">=</span> <span class="token class-name">LoadBalancer</span><span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		balancer4 <span class="token operator">=</span> <span class="token class-name">LoadBalancer</span><span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//判断服务器负载均衡器是否相同</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>balancer1 <span class="token operator">==</span> balancer2 <span class="token operator">&amp;&amp;</span> balancer2 <span class="token operator">==</span> balancer3 <span class="token operator">&amp;&amp;</span> balancer3 <span class="token operator">==</span> balancer4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;服务器负载均衡器具有唯一性！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">//增加服务器</span>
		balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">&quot;Server 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">&quot;Server 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">&quot;Server 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">&quot;Server 4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//模拟客户端请求的分发</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> server <span class="token operator">=</span> balancer1<span class="token punctuation">.</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;分发请求至服务器： &quot;</span> <span class="token operator">+</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="language- extra-class"><pre><code>编译并运行程序，输出结果如下：
服务器负载均衡器具有唯一性！
分发请求至服务器：  Server 1
分发请求至服务器：  Server 3
分发请求至服务器：  Server 4
分发请求至服务器：  Server 2
分发请求至服务器：  Server 3
分发请求至服务器：  Server 2
分发请求至服务器：  Server 3
分发请求至服务器：  Server 4
分发请求至服务器：  Server 4
分发请求至服务器：  Server 1
</code></pre></div><p>​    虽然创建了四个LoadBalancer对象，但是它们实际上是同一个对象，因此，通过使用单例模式可以确保LoadBalancer对象的唯一性。</p> <h4 id="_3-饿汉式单例与懒汉式单例的讨论"><a href="#_3-饿汉式单例与懒汉式单例的讨论" class="header-anchor">#</a> 3 饿汉式单例与懒汉式单例的讨论</h4> <div class="language- extra-class"><pre><code>Sunny公司开发人员使用单例模式实现了负载均衡器的设计，但是在实际使用中出现了一个非常严重的问题，当负载均衡器在启动过程中用户再次启动该负载均衡器时，系统无任何异常，但当客户端提交请求时出现请求分发失败，通过仔细分析发现原来系统中还是存在多个负载均衡器对象，导致分发时目标服务器不一致，从而产生冲突。为什么会这样呢？Sunny公司开发人员百思不得其解。
</code></pre></div><p>现在我们对负载均衡器的实现代码进行再次分析，当第一次调用getLoadBalancer()方法创建并启动负载均衡器时，instance对象为null值，因此系统将执行代码instance= new LoadBalancer()，在此过程中，由于要对LoadBalancer进行大量初始化工作，需要一段时间来创建LoadBalancer对象。而在此时，如果再一次调用getLoadBalancer()方法（通常发生在多线程环境中），由于instance尚未创建成功，仍为null值，判断条件(instance== null)为真值，因此代码instance= new LoadBalancer()将再次执行，导致最终创建了多个instance对象，这违背了单例模式的初衷，也导致系统运行发生错误。</p> <p>如何解决该问题？我们至少有两种解决方案，在正式介绍这两种解决方案之前，先介绍一下单例类的两种不同实现方式，饿汉式单例类和懒汉式单例类。</p> <ul><li><p>饿汉式单例类</p> <p>饿汉式单例类是实现起来最简单的单例类，饿汉式单例类结构图如图3-4所示：</p></li></ul> <p><img src="data:image/gif;base64,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" alt=""></p> <p>​    从图3-4中可以看出，由于在定义静态变量的时候实例化单例类，因此在类加载的时候就已经创建了单例对象，代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">EagerSingleton</span> <span class="token punctuation">{</span> 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">EagerSingleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EagerSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">private</span> <span class="token class-name">EagerSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> 

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">EagerSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​      当类被加载时，静态变量instance会被初始化，此时类的私有构造函数会被调用，单例类的唯一实例将被创建。如果使用饿汉式单例来实现负载均衡器LoadBalancer类的设计，则不会出现创建多个单例对象的情况，可确保单例对象的唯一性。</p> <ul><li><p>懒汉式单例类与线程锁定</p> <p>除了饿汉式单例，还有一种经典的懒汉式单例，也就是前面的负载均衡器LoadBalancer类的实现方式。懒汉式单例类结构图如图3-5所示：</p></li></ul> <p><img src="data:image/gif;base64,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" alt=""></p> <p>从图3-5中可以看出，懒汉式单例在第一次调用getInstance()方法时实例化，在类加载时并不自行实例化，这种技术又称为延迟加载(Lazy Load)技术，即需要的时候再加载实例，为了避免多个线程同时调用getInstance()方法，我们可以使用关键字synchronized，代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">LazySingleton</span> <span class="token punctuation">{</span> 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 

    <span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> 
     
    <span class="token keyword">synchronized</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>​       该懒汉式单例类在getInstance()方法前面增加了关键字synchronized进行线程锁，以处理多个线程同时访问的问题。但是，上述代码虽然解决了线程安全问题，但是每次调用getInstance()时都需要进行线程锁定判断，在多线程高并发访问环境中，将会导致系统性能大大降低。如何既解决线程安全问题又不影响系统性能呢？我们继续对懒汉式单例进行改进。事实上，我们无须对整个getInstance()方法进行锁定，只需对其中的代码“instance = new LazySingleton();”进行锁定即可。因此getInstance()方法可以进行如下改进：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>​       问题貌似得以解决，事实并非如此。如果使用以上代码来实现单例，还是会存在单例对象不唯一。原因如下：
​      假如在某一瞬间线程A和线程B都在调用getInstance()方法，此时instance对象为null值，均能通过instance == null的判断。由于实现了synchronized加锁机制，线程A进入synchronized锁定的代码中执行实例创建代码，线程B处于排队等待状态，必须等待线程A执行完毕后才可以进入synchronized锁定代码。但当A执行完毕时，线程B并不知道实例已经创建，将继续创建新的实例，导致产生多个单例对象，违背单例模式的设计思想，因此需要进行进一步改进，在synchronized中再进行一次(instance == null)判断，这种方式称为双重检查锁定(Double-Check Locking)。使用双重检查锁定实现的懒汉式单例类完整代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">LazySingleton</span> <span class="token punctuation">{</span> 
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 

    <span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> 
     
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">//第一重判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//锁定代码块</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//第二重判断</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建单例实例</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>​       需要注意的是，如果使用双重检查锁定来实现懒汉式单例类，需要在静态成员变量instance之前增加修饰符volatile，被volatile修饰的成员变量可以确保多个线程都能够正确处理，且该代码只能在JDK 1.5及以上版本中才能正确执行。由于volatile关键字会屏蔽Java虚拟机所做的一些代码优化，可能会导致系统运行效率降低，因此即使使用双重检查锁定来实现单例模式也不是一种完美的实现方式。</p> <ul><li><p>饿汉式单例类与懒汉式单例类比较</p> <p>饿汉式单例类在类被加载时就将自己实例化，它的优点在于无须考虑多线程访问问题，可以确保实例的唯一性；从调用速度和反应时间角度来讲，由于单例对象一开始就得以创建，因此要优于懒汉式单例。但是无论系统在运行时是否需要使用该单例对象，由于在类加载时该对象就需要创建，因此从资源利用效率角度来讲，饿汉式单例不及懒汉式单例，而且在系统加载时由于需要创建饿汉式单例对象，加载时间可能会比较长。</p> <p>懒汉式单例类在第一次使用时创建，无须一直占用系统资源，实现了延迟加载，但是必须处理好多个线程同时访问的问题，特别是当单例类作为资源控制器，在实例化时必然涉及资源初始化，而资源初始化很有可能耗费大量时间，这意味着出现多线程同时首次引用此类的机率变得较大，需要通过双重检查锁定等机制进行控制，这将导致系统性能受到一定影响。</p></li></ul> <h4 id="_4-一种更好的单例实现方法"><a href="#_4-一种更好的单例实现方法" class="header-anchor">#</a> 4 一种更好的单例实现方法</h4> <p><strong>Initialization Demand Holder (IoDH)</strong></p> <p>在IoDH中，我们在单例类中增加一个****静态**(static)**内部类****，在该内部类中创建单例对象，再将该单例对象通过getInstance()方法返回给外部使用，实现代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//Initialization on Demand Holder</span>
<span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HolderClass</span> <span class="token punctuation">{</span>
            <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">return</span> <span class="token class-name">HolderClass</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token class-name">Singleton</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">;</span> 
            s1 <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    s2 <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token operator">==</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>编译并运行上述代码，运行结果为：true，即创建的单例对象s1和s2为同一对象。由于静态单例对象没有作为Singleton的成员变量直接实例化，因此类加载时不会实例化Singleton，第一次调用getInstance()时将加载内部类HolderClass，在该内部类中定义了一个static类型的变量instance，此时会首先初始化这个成员变量，由Java虚拟机来保证其线程安全性，确保该成员变量只能初始化一次。由于getInstance()方法没有任何线程锁定，因此其性能不会造成任何影响。</p> <p>通过使用IoDH，我们既可以实现延迟加载，又可以保证线程安全，不影响系统性能，不失为一种最好的Java语言单例模式实现方式（其缺点是与编程语言本身的特性相关，很多面向对象语言不支持IoDH）。</p> <h4 id="_5单例模式总结"><a href="#_5单例模式总结" class="header-anchor">#</a> 5单例模式总结</h4> <p>​       单例模式作为一种目标明确、结构简单、理解容易的设计模式，在软件开发中使用频率相当高，在很多应用软件和框架中都得以广泛应用。</p> <p>1.主要优点</p> <p>单例模式的主要优点如下：</p> <p>(1) 单例模式提供了对唯一实例的受控访问。因为单例类封装了它的唯一实例，所以它可以严格控制客户怎样以及何时访问它。</p> <p>(2) 由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象单例模式无疑可以提高系统的性能。</p> <p>(3) 允许可变数目的实例。基于单例模式我们可以进行扩展，使用与单例控制相似的方法来获得指定个数的对象实例，既节省系统资源，又解决了单例单例对象共享过多有损性能的问题。</p> <p>2.主要缺点</p> <p>单例模式的主要缺点如下：</p> <p>(1) 由于单例模式中没有抽象层，因此单例类的扩展有很大的困难。</p> <p>(2) 单例类的职责过重，在一定程度上违背了“单一职责原则”。因为单例类既充当了工厂角色，提供了工厂方法，同时又充当了产品角色，包含一些业务方法，将产品的创建和产品的本身的功能融合到一起。</p> <p>(3) 现在很多面向对象语言(如Java、C#)的运行环境都提供了自动垃圾回收的技术，因此，如果实例化的共享对象长时间不被利用，系统会认为它是垃圾，会自动销毁并回收资源，下次利用时又将重新实例化，这将导致共享的单例对象状态的丢失。</p> <p>3.适用场景</p> <p>在以下情况下可以考虑使用单例模式：</p> <p>(1) 系统只需要一个实例对象，如系统要求提供一个唯一的序列号生成器或资源管理器，或者需要考虑资源消耗太大而只允许创建一个对象。</p> <p>(2) 客户调用类的单个实例只允许使用一个公共访问点，除了该公共访问点，不能通过其他途径访问该实例。</p> <h3 id="原型模式"><a href="#原型模式" class="header-anchor">#</a> 原型模式</h3> <h4 id="_1-案例"><a href="#_1-案例" class="header-anchor">#</a> 1 案例</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>Sunny软件公司一直使用自行开发的一套OA (Office Automatic，办公自动化)系统进行日常工作办理，但在使用过程中，越来越多的人对工作周报的创建和编写模块产生了抱怨。追其原因，Sunny软件公司的OA管理员发现，由于某些岗位每周工作存在重复性，工作周报内容都大同小异，如图7-1工作周报示意图。这些周报只有一些小地方存在差异，但是现行系统每周默认创建的周报都是空白报表，用户只能通过重新输入或不断复制粘贴来填写重复的周报内容，极大降低了工作效率，浪费宝贵的时间。如何快速创建相同或者相似的工作周报，成为Sunny公司OA开发人员面临的一个新问题。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Sunny公司的开发人员通过对问题进行仔细分析，决定按照如下思路对工作周报模块进行重新设计和实现：</p> <p>(1)除了允许用户创建新周报外，还允许用户将创建好的周报保存为模板；</p> <p>(2)用户在再次创建周报时，可以创建全新的周报，还可以选择合适的模板复制生成一份相同的周报，然后对新生成的周报根据实际情况进行修改，产生新的周报。</p> <p>只要按照如上两个步骤进行处理，工作周报的创建效率将得以大大提高。</p> <h4 id="_2-原型模式概述"><a href="#_2-原型模式概述" class="header-anchor">#</a> 2 原型模式概述</h4> <p>​      在使用原型模式时，我们需要首先创建一个原型对象，再通过复制这个原型对象来创建更多同类型的对象。试想，如果连孙悟空的模样都不知道，怎么拔毛变小猴子呢？原型模式的定义如下：</p> <p>原型模式(Prototype  Pattern)：使用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。原型模式是一种对象创建型模式。</p> <p>原型模式的工作原理很简单：将一个原型对象传给那个要发动创建的对象，这个要发动创建的对象通过请求原型对象拷贝自己来实现创建过程。由于在软件系统中我们经常会遇到需要创建多个相同或者相似对象的情况，因此原型模式在真实开发中的使用频率还是非常高的。原型模式是一种“另类”的创建型模式，创建克隆对象的工厂就是原型类自身，工厂方法由克隆方法来实现。</p> <p>需要注意的是通过克隆方法所创建的对象是全新的对象，它们在内存中拥有新的地址，通常对克隆所产生的对象进行修改对原型对象不会造成任何影响，每一个克隆对象都是相互独立的。通过不同的方式修改可以得到一系列相似但不完全相同的对象。</p> <p>原型模式的结构如图7-2所示：</p> <p><img src="data:image/gif;base64,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" alt=""></p> <p>图7-2 原型模式结构图</p> <p>在原型模式结构图中包含如下几个角色：</p> <p>●Prototype（抽象原型类）：它是声明克隆方法的接口，是所有具体原型类的公共父类，可以是抽象类也可以是接口，甚至还可以是具体实现类。</p> <p>● ConcretePrototype（具体原型类）：它实现在抽象原型类中声明的克隆方法，在克隆方法中返回自己的一个克隆对象。</p> <p>● Client（客户类）：让一个原型对象克隆自身从而创建一个新的对象，在客户类中只需要直接实例化或通过工厂方法等方式创建一个原型对象，再通过调用该对象的克隆方法即可得到多个相同的对象。由于客户类针对抽象原型类Prototype编程，因此用户可以根据需要选择具体原型类，系统具有较好的可扩展性，增加或更换具体原型类都很方便。</p> <p>原型模式的核心在于如何实现克隆方法，下面将介绍两种在Java语言中常用的克隆实现方法：</p> <ol><li>通用实现方法</li></ol> <p>通用的克隆实现方法是在具体原型类的克隆方法中实例化一个与自身类型相同的对象并将其返回，并将相关的参数传入新创建的对象中，保证它们的成员属性相同。示意代码如下所示</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ConcretePrototype</span> <span class="token keyword">implements</span> <span class="token class-name">Prototype</span>
<span class="token punctuation">{</span>
<span class="token keyword">private</span> <span class="token class-name">String</span>  attr<span class="token punctuation">;</span> <span class="token comment">//成员属性</span>
<span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">setAttr</span><span class="token punctuation">(</span><span class="token class-name">String</span> attr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>attr <span class="token operator">=</span> attr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span>  <span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">Prototype</span>  <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//克隆方法</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Prototype</span>  prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建新对象</span>
    prototype<span class="token punctuation">.</span><span class="token function">setAttr</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> prototype<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>在客户类中我们只需要创建一个ConcretePrototype对象作为原型对象，然后调用其clone()方法即可得到对应的克隆对象，如下代码所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Prototype</span> obj1  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span><span class="token function">setAttr</span><span class="token punctuation">(</span><span class="token string">&quot;Sunny&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Prototype</span> obj2  <span class="token operator">=</span> obj1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这种方法可作为原型模式的通用实现，它与编程语言特性无关，任何面向对象语言都可以使用这种形式来实现对原型的克隆。</p> <ol start="2"><li>Java语言提供的clone()方法</li></ol> <p>学过Java语言的人都知道，所有的Java类都继承自java.lang.Object。事实上，Object类提供一个clone()方法，可以将一个Java对象复制一份。因此在Java中可以直接使用Object提供的clone()方法来实现对象的克隆，Java语言中的原型模式实现很简单。</p> <p>需要注意的是能够实现克隆的Java类必须实现一个标识接口Cloneable，表示这个Java类支持被复制。如果一个类没有实现这个接口但是调用了clone()方法，Java编译器将抛出一个CloneNotSupportedException异常。如下代码所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ConcretePrototype</span> <span class="token keyword">implements</span>  <span class="token class-name">Cloneable</span>
<span class="token punctuation">{</span>
……
<span class="token keyword">public</span> <span class="token class-name">Prototype</span>  <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
　　<span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
　　<span class="token keyword">try</span> <span class="token punctuation">{</span>
　　　　　object <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
　　　　　<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Not support cloneable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　<span class="token punctuation">}</span>
　　<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Prototype</span> <span class="token punctuation">)</span>object<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
……
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在客户端创建原型对象和克隆对象也很简单，如下代码所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Prototype</span> obj1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Prototype</span> obj2 <span class="token operator">=</span> obj1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- extra-class"><pre><code>一般而言，Java语言中的clone()方法满足：
</code></pre></div><p>(1) 对任何对象x，都有x.clone() != x，即克隆对象与原型对象不是同一个对象；</p> <p>(2) 对任何对象x，都有x.clone().getClass() == x.getClass()，即克隆对象与原型对象的类型一样；</p> <p>(3) 如果对象x的equals()方法定义恰当，那么x.clone().equals(x)应该成立。
为了获取对象的一份拷贝，我们可以直接利用Object类的clone()方法，具体步骤如下：</p> <p>(1) 在派生类中覆盖基类的clone()方法，并声明为public；</p> <p>(2) 在派生类的clone()方法中，调用super.clone()；</p> <p>(3)派生类需实现Cloneable接口。</p> <p>此时，Object类相当于抽象原型类，所有实现了Cloneable接口的类相当于具体原型类。</p> <h4 id="_3-完整解决方案-2"><a href="#_3-完整解决方案-2" class="header-anchor">#</a> 3 完整解决方案</h4> <p>​      Sunny公司开发人员决定使用原型模式来实现工作周报的快速创建，快速创建工作周报结构图如图7-3所示：</p> <p><img src="data:image/gif;base64,R0lGODlhSgEtAdUAAAAAALb/tpCQOgAAZjqQ22YAAP//tpDbtgA6kP///2Y6AJDb2/+2ZgAAOjqQkABmtjoAADoAZma22zo6Ztv/tmYAOrZmAP//2zoAOv/bkNuQOpmZZgBmZpA6OmZmZmYAZjpmtmaZmbb//5A6AABmmTo6kNvbkNv//7ZmOpA6ZjqQtrb/25C2kAA6Ojo6Oma2/5Db/7bbkGa2tjpmZtv/27aQOgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAAHAP8ALAAAAABKAS0BAAb/QIBwSCwaj8ikcslsOpeJqHRKrVqv2Kx2y+16u8+weAyNAr7otHrNlp7b8Lh8zn3T72m7Hc/vs/d+gYJ9gIODeoaJim6LjY5gj4GIixkQQgMiURcjL1ObnZFbhaGki4BCWZVCD1EZEZl3n1OusFaTiQwAoAwNMAmya7SmpcSOe2+jCQyYvyOswrGcs69Yt4PAURoIJ9hp0InJxeJ4t0RTBgWgCRkYMN9z3e9U1oLv7DCbHkIEzZ3oAMzWWdL1r5eicOMSxjmGysqyWlKEqTLoSsA+Kf8C5lrVTB8AfsIy1qIXiMG2c+k2bUP34pMsbSdYrnslTxBChTjV3Jxi8kQV/1oyH1bi97BfAphBe6mMmY7Wy5MJSPrpibKltAQWHnwKWQEG1YjUDuYcK2enlK/TRHB1125mprXnugLLSgtuVEaJ3hmQe1WDVk6qhPSCmXYY2cNrzEYpSoUW1a3UJA4EQHGg0r4P6k42eNeMom4w5xKADBGtW8OIU3tRnEBmFJZ1qe11F7k2xHut+YKyQCA2RM/AcelabHBpJavI3cq8h1us6ueivmgoPmIb0HTKMEmkJssxMwuXrUN44VQaNKmB/gGEle+irIK+BArptGk4OOj4q6HZCIDV6Ym+bAcLfM0IoQIn7X10GoHBsdZINwo5mF9OEiKGHjGzkVXhhAltqP8hXgppAABUFHJoYmcnzgNiio94yGIoLpYY3IuNxEhjjTc2SMaOPPbooxI5qvbjkEQ2hGKQhtiI5CFBXrjkHUo+6UeU4zgpZVlXynijlVm2QWWXc3xZDJdg6lRmlU2ueCaWaxIjpptqtumlnKW8WWecdJqZZyR2kkLmnln0CagWgvKJ56CQIIoajX8qqqKj9+XYKKQzUjplmpVaGqimNmF6JKf6gUqIp4VmWaqmp+KYqaiPsgolqa6GGmuYpBZp6624pkpprrw6cWisukIabKSfzrqqsXpu+aurwyraLJPHAossm8pG20VNbGjQGwjeDBRQNxB+8eyg40qyLBfYqmH/wAeZWKAOF7nsQt27X8hT7p73jpqpX16km4a2i5GoBWjbhHttWOdOWwesVPB7RWCdSEZZgBFYpGBrBaxHxQUdxJdhFbw1hvA67STIz3sZBxSYDBlzZq3CC0sap8NVLEfTK0FpBwFRmDzlE1jsXbWFaSwtVTSC0iCFnSsxjFwszOIyrEwRLgf8cys3ZzIbbr7lFt9iAWHFD7wCH73bX+TJ1hVa9kL9h9RS0NywwI6dRJpbgU3ME4khozvybMD4tdVmMBCG9W/50pk4OTP7V4VpXW9tW7rf9L0FwdxcxdvdZ5HYttvJMtr4Fcu1c10nQtnW3cjQGHxFvMT5Ytx4LpmH//PSGLDQ1hSLt9k7HZPKN5zEFNmGsd6eXPUxFZajdEnQHp0sDYMQ1/fu72diT632R41tGh2uxww6GtzDEfwg67ZLLx3L5zG++zK//Ii2GZRw9R0iCkz++/vH//Ss5TNVrXpFwAIygX/iMqACh3AYIyEQgAFs0f8eiKoJ+k5+FEQUMjSYsAwC6nxIOoYHQSVCfLVqhLs64QVViEJyVSGC0GJhC034QsUlYYYavOEHcUjCFPKwgsL6IRAdBUMhGnFTR0zic4qoxCZa0IlgYqKqoJgnKS6KiiskIha3OCYuehFGXwzjFMUowCCSsUtWdM4Zr5RGYq3xjcCDoxxpNcc6vv/Njv5zFh7zyME9is6MfgwkEgVJyBoW8pAdRCRO2pgkHDLQDEZ6ZFQiSUk9VNINl4SkJTeJSU5qspOJLBMjFcmpBZrSR6Q85ChT6cM4svKHb1rlKycUy1nyUJa23GEu8YjLXSqOcb4cYS2D6cFhEpOCvTymKJUJx2Qys4yufOb7jClN0FGzmlBzJjZDuM0warOb1YomOKd1zXEm5pToTKc610mGIZrTjVp8pxoBKc8Y0vNJWTnLxbDiuIEJDVv+omErpWQ4C3jAP5sY2+X+6bTDuTOeVwrJBwLALq91ARsAbWgfB/qk5ZSABh1TxkpSVguRGCUXM3hFPrORGacBqBX/liCB0KT0zVd1KWQAyynajmK3pBWME7ygjVq4A5i/YechMhHR+rhpqZpmgQGscJdIT+AuuKxlEyFoS3kilrXCzIYqrmHjQ59UPwpUdF0UVQvhhDcxldTgGdTgF8De8RhOECZ84bznkzjGAvv9ogN9PYE83vEJyWntAysIqT3U5pWThJWmY8WnCxSqAQ9Ij6uZWJ0IZGESE4TFAiHwq16Oiomk2kesTS1TUPUJCgYdb17NaEFYYMdWBb1UPhzoChojC7WAZqF9T3IqHfknN3S1hTGo5WhvIRA2L4gIedDUaz31pdzp8kG4ZWGndrfLXXXy1rrihCh4qSvd8Q63vM+p/w9HHqbRJGJ3ISla6SZa+psvvtd8J1oe09q7xfvOSQsVucjU1otVS2TGwMdrrheaN1/n9SIDE1DAAJo2VIuNTRUyXeoD/XvHVOwsOyJIiuyqwxTrYGABPr0fG9TjH8lgdiggNq2GEcjhxGyBa3/TrSx2PIIQMPYO/6AvySimFq2+AqzYaWGN9fTcfjpUYnrjMX16vFY8sIMFxusaLe4602J+F2h4a0uGpNwMH9e3DcjFapa7WjefPNbLqQWwbYoCnhFPecoSsN2Z0bCUbCDABEZ+C5tv1wmlznDJ8EuF6kZgIGmQubAt+9oXmhcFCwzhp7oQkIBwq1slf1lOwM0gov/7ByjcIFeYny7Tc6uG6jib97qpfnXoxCvr89JaC6EOhXr7gwXfwjLWGOn0T/jLB/k6w9dOHHXUvJDr0yRCvxGg8BqVvRp4CSG3vuAPK+BjUjkw2BkOdkeEJ3wzC8MUABk+dKqT2gsRu8VnfmDxk8eDtw8jFTuG9rSrsQBWYVs0cv7uQ5AlEmgciwDJM+YftRPV5CoQJkOBKZ5ah8BqP1x5zUMVtAi4nPBpprrfbPEFxLsqiDT3GOMCQri69006fPeCzhQpmZ770GeeAprIeLONjFde3Z9YwgF8afSUCRLpOVAaK5fOXKYnl2VLYJvn6KVTs2kM7IgeV8GirvqVVi3/6Vb3vNYdjjrYEy32sS/766rZtZMLg8WFi48PyHZoF4wt5DO6PToWJ7bI9lwzYe+X722PNcTOXTwLE8ikAf6Ia6fw7X7CB8ISpnDiLxzTLmed5VawWYhJq1aeZdwoMIFx6gBPBXn/h96a8fzO9Y12q3m1Kwbf9NYKrvfMZ0zIsQ+0yllvxobP7X51TZvGoTwxTdf+YblDuW04DvVbP45ujDW+xgvTNXiFTc3T1/KRHZtkFN6dUFsoHQxy9vm6tEWzmt7dQqGijZv/Z9CbL/RpvV524YHipQKy3mtxXp75S+HoliYEmCZ8OZd9Thdwl9d6bTJ1Cqd1ZHV1pDc+3zdI/4DCdY7kgGYnK8LSXRzYgR5YJBiYgbYQgiIoQy5Ugv+lgGwAY3KHBwCjdooWgXnBLeOgFwhYbZgXB5qhMseHBunDT5oAbnEXClJFFgwIfixXXN5QbhfWg9LBD9D2eYfxPQlxhBRIa0rIE4IhciT1Wli2AikwfQPGawXWH6qwbV3oCSHVYA7GAuM2VE1jbueWblgjh2PICmV4YLzWbVaYBpYjDN1hCRI3YE9nY0m4dsGWbQhAAylWgFC1IEcVHiUmWCfWiGB2PLx2OMeBNTFgb8ywegLheRiDOpKIDiaGYoXWUx0XB91hP+R3OkdRcTjoQ/yxhTXTfVaVNRwjVKWnG/9GgX0WdRYKFmRhFh9ME2hTNYoRgYxxgQ+O9oxmFoxHxwdyBRLRt31udoOJwlFZiBEZk2lrpWUgAA0R54x3VmZV5no/YTok93enwXxPFhbl+GhURnHxMY1W9lEhFXxb5lja+HZYiIiPQ26/UX2gFRli5os8Fo1WIAwmJ3zkGG3Gs3vv9xYJaY6/eHL1hY94gAKBtSCwh43BOGt6NAXdOGTZsQIzxxzyyFyZAHMYyWN5hlmFUXOhx46w4I4hgW+ntWkwSY8zeRp4RQe5MDavSGix2HVnV39aqDcMUh8MeRTMoF4HkhxStnhGUWlJVyAMqZMtCQCFWJEFAgBVSY8vwCD/fYgGlPaDhMd/P/ePeKeCqQEwAgeXc0CFfFSSLMKWcmBqWFdsq5giE6iBKUKXc2CBg1A/KsZUcomCVzCYj+mYYed8kgmQegl3k7FPcECXMMheMogFaTkLNAgdNqiUs8iU9UJy6KBQwxaBbEl3Q8hsN+gvRZhfdnmFl3kUAtkvJAdinrkFdAlt0oYHueYveAkdoWlI3LibA2YQJlUQWFZSnaZt3JaGUrCLQeh4kQZ5BDl5c9hlG/F01Fl0fHibffCHRBUxgohz4WmekXmIoKlbJsGIqegT1WcUIrZVPHU/32B6LlZvqseT78Ju4xeJvAhvQ5kIrcgUqKMdSDkdprmN/2ZUi9DljeqQi1KYlYkIcJJ2aq9xewRHZAZHkcnYPoYFkvfImqRQjSjaZiNJdgH5W99IHuHYmx9Tjpphj3uzmK2QfNkHf/DoZ9kYIJbBi3nDGRzZCPUDUoroE6TxcO45gvA5NAS5d99QFLhhWJQzW9enkRWZctz3LiCXpSEphoynoqTgkaJ1jQfnjxFqmRvFUr12dSpJkyw5IAXgPd/xYDJHk5dok3+GjNoXf0cxfwQKk7ihWRpKDEX5oQ2acQQ6mbk5NLb4lIwWApmpDlSJNERXoYsagCOidAQ4qJzWdaoAdM4odPqHllF6B2tZUW15egCAqpIap89hmMTZql1wnP/ZQ4KkwJc6CIGAaauTqhq4GgeIeQeKSazMWplxiZrOGkq9Gq1LSZl0EBjMKQicyWjr1ZBOWAoZMJp9mWNv+qzWuoLUUBRseDCf6WwYAauw+a19MITQUJt1Wa5IuJxwAIs9iq9s5ze/EZx+J5HtmnftCg28GgfJaYK6FDfMuRHO2YUFsQF/KR+Ftw+H14WT51rY2QzaWXzjJnkVI2AY1mWDd1sbG2ndlrJOeYPomVnmsZ6n0Z7+Spi5eZIZMp+N6KK3+Kii56AwW58/m6Hu6p+RgXo04YmEmm+OOhMBwHmhCGL6SRhD2zqWVwULepRLK4sSGk8UWnFhhaF4uRaxZzz/syeiI+Ohx4N7Bad7YbqjYAZxtPd5cou2tZCkDts9LSqSC8s7D3WSmEijOuodZ8aPTPcWhCN9cNuQPvqly6eKJkkiwee4E2eLiltpaNqQ+tik/dCPQ1qrJ5i3VDqcQBNWmuc1irtYw8c6XFoLwJi6fNt9yehQI7e6REu5/5e5VqCm9smmIAe6DSunyJdtA1Cn/9EWENoMbzt6xWgUg9occgeo7ge7S2uouHMAUJt+GLlp5hcfCboYF6O1kWqIjQm+Tll0BYI6Q9BP+Ldow0Eg+cdomjpToDqA1FuqjTEQ6ok88dupnNG//uCyKsqX7Yu4s6qrfpuDSHKs7IPAfJCw/3CiwEECrPsqrMRgr1oCrSfCwG2QrKSwrA3kq44JmVJKrV1brCb8nuXbLQoVm10wV+IqKp3prQVrs83aBpLBgzUcfvAamIMSrzt8mjGKw7UhAE0YxFlgmBA8KMIpr9V6s8xZsv5AUo8XAWA4fdqGjmaIYAkGER37oojSeOHGnSIrh1Kcr/eEswLqMykHV4QaVEZTACaGkYbjrt8LKEaLuC+mtKCowhNKNUqJcGSrOh1TmmZpF76Zu8YycAgpom7rZrJbwmm8mxx3pEYaGeN4tFt4yOloGnhrKRf3o+X3CkHqx0PsEGGqus52kEUmcgr5jATYmmfKKiYXjdRLopJ8yv89W6jJ0b3OVgmY8JOw3A+K2oJ3nCfSK6jw18e5jMK9doBcGGXy+w0a0DPcWpbDjDIVig19eyUAmHTWc7+qEJam7My45sDUqFBLnEFHSMLKaVzEi8TE2cNC5Jek584MewUeTAxz5VdCtM/NfMMpnM9VNNBwGrrzmpm6+y/b4jYzLMvwJcHoKoar+Zs8rD5QA8TmMqUT7a5q665J7D36EytNLM/mCsUehm7TQ8XbiTA5u74ZqzFq6DHofCZi7I0gG3nlRrKV13H4nMCia3vylxyhZzxBeJYGCoiWGL1X6yp5LBB7HKBDjcZeC8jPB8kEeKLf0A1a/WPCeLcLTdIg2sj/zeuib/bOuvx7nZu4Rv1vRUp8VYMWn+wqoYy7nruoAY3Quslvqcy6ZioUF7lpNKzI01LLyqdxuIzWKN1yQ41+zFjRiHp+M/enTS3DJOZn03u4yiGgVG3ODQnN+5e+eWMfm2oV74u+16k8NV0m3yyAoirOoI2bAv1bq50tIs2jSdTOWmfPkfCDGHxEvC3beg2cthgK9OPPTgTQij3bBv1Ev9Tcwh280L3cw42Z3eoI9BPDe/LQe0ctGgywYAOz2drd7Fp6FfXbdKLRl8LRwSAbuKh+N+aE8kCX63wlJb3R+vrMKj3F6wEfH92+5ladMs2yLtOx3XwiN/2hOd2dI3sx/2cc3QIlvELNy2ycriP9ikr7bjurtKqM11L3jS12tFEdY5wN4QU9hsUNt7DBprP7eiGHu3VbgDwRNnNdJoxskY5MZIlN0M8d1A6nipbskFhnuKJsybjbOVdT42dS19Rbynkt3ScpyH6tjI46yEXuUpp9iWIzKIZ95Yj9tibe4xK+y0rl2PGRvHHss1nWp2Lpy5Ttw1KSzPy3zCVuw9Wd0k9HIPp3hxEhs5tmPdTjvvPbWrWdH60dquGs2RJDzk8e4V9w4Nh92x6k2xK9jvH8HL4N53RtwXYu3cTtqYhx3LgNNcrN43Ly00KE6hg00Kru3Abd6jHiwiG9DtrtQYHxLf8zdcyd7uhoIOukQ88tRFurpevkbepZNOZyZtImqc4jjUCYQ+z/CtSTnNJLZ8AXu0/dpgkh9RqFrijNYw8yFz34mYYQg5Wufux7zdgzQWEYLorwZsyVPT5EkxIkZjY+o3nYAuvmq6NUwDZddbZiuTynpuSFXTb0fjZ381XQd2b6bpKU7DkieTdw/TWeHNagY8iYMTj2WMcgLa3L5PB8fTUcyr0a9Q4EjyzPrjmjUVSlsfCNfuI+Xnq4E51aK5STbcfxLu/2Mewkdhy1g1niB73Sfq6fPR/EM+d4us1CA+mUcnTqgevirs3/q7/pS92evqLMPupHBO1Wz+u/CuxbxPQkq74m3NPPWm9E+XP2B3310z322fOBcB/3cl8GbV/3dn/3TRQEADs=" alt=""></p> <p>图7-3 快速创建工作周报结构图</p> <p>在图7-3中，WeeklyLog充当具体原型类，Object类充当抽象原型类，clone()方法为原型方法。WeeklyLog类的代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//工作周报WeeklyLog：具体原型类，考虑到代码的可读性和易理解性，只列出部分与模式相关的核心代码</span>

<span class="token keyword">class</span> <span class="token class-name">WeeklyLog</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span>

<span class="token punctuation">{</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> name<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> date<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> content<span class="token punctuation">;</span>
       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token operator">=</span> name<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token class-name">String</span> date<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>date  <span class="token operator">=</span> date<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>content  <span class="token operator">=</span> content<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token comment">//克隆方法clone()，此处使用Java语言提供的克隆机制</span>
       <span class="token keyword">public</span> <span class="token class-name">WeeklyLog</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
              <span class="token keyword">try</span>
              <span class="token punctuation">{</span>
                     obj <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">WeeklyLog</span><span class="token punctuation">)</span>obj<span class="token punctuation">;</span>     
              <span class="token punctuation">}</span>
              <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;不支持复制！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>编写如下客户端测试代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span>
<span class="token punctuation">{</span>
       <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token class-name">WeeklyLog</span> log_previous <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeeklyLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//创建原型对象</span>
              log_previous<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;张无忌&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              log_previous<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token string">&quot;第12周&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              log_previous<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">&quot;这周工作很忙，每天加班！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;****周报****&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;周次：&quot;</span> <span class="token operator">+</span>  log_previous<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;姓名：&quot;</span> <span class="token operator">+</span>  log_previous<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;内容：&quot;</span> <span class="token operator">+</span>  log_previous<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;--------------------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">WeeklyLog</span>  log_new<span class="token punctuation">;</span>
              log_new  <span class="token operator">=</span> log_previous<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用克隆方法创建克隆对象</span>
              log_new<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token string">&quot;第13周&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;****周报****&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;周次：&quot;</span> <span class="token operator">+</span> log_new<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;姓名：&quot;</span> <span class="token operator">+</span> log_new<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;内容：&quot;</span> <span class="token operator">+</span> log_new<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>通过已创建的工作周报可以快速创建新的周报，然后再根据需要修改周报，无须再从头开始创建。原型模式为工作流系统中任务单的快速生成提供了一种解决方案。</p> <h4 id="_4-深克隆与浅克隆"><a href="#_4-深克隆与浅克隆" class="header-anchor">#</a> 4 深克隆与浅克隆</h4> <p>​      通过引入原型模式，Sunny软件公司OA系统支持工作周报的快速克隆，极大提高了工作周报的编写效率，受到员工的一致好评。但有员工又发现一个问题，有些工作周报带有附件，例如经理助理“小龙女”的周报通常附有本周项目进展报告汇总表、本周客户反馈信息汇总表等，如果使用上述原型模式来复制周报，周报虽然可以复制，但是周报的附件并不能复制，这是由于什么原因导致的呢？如何才能实现周报和附件的同时复制呢？我们在本节将讨论如何解决这些问题。</p> <p>在回答这些问题之前，先介绍一下两种不同的克隆方法，浅克隆(ShallowClone)和深克隆(DeepClone)。在Java语言中，数据类型分为值类型（基本数据类型）和引用类型，值类型包括int、double、byte、boolean、char等简单数据类型，引用类型包括类、接口、数组等复杂类型。浅克隆和深克隆的主要区别在于是否支持引用类型的成员变量的复制，下面将对两者进行详细介绍。</p> <ol><li>浅克隆</li></ol> <p>在浅克隆中，如果原型对象的成员变量是值类型，将复制一份给克隆对象；如果原型对象的成员变量是引用类型，则将引用对象的地址复制一份给克隆对象，也就是说原型对象和克隆对象的成员变量指向相同的内存地址。简单来说，在浅克隆中，当对象被复制时只复制它本身和其中包含的值类型的成员变量，而引用类型的成员对象并没有复制，如图7-4所示：</p> <p><img src="data:image/gif;base64,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" alt=""></p> <p>图7-4 浅克隆示意图</p> <p>在Java语言中，通过覆盖Object类的clone()方法可以实现浅克隆。为了让大家更好地理解浅克隆和深克隆的区别，我们首先使用浅克隆来实现工作周报和附件类的复制，其结构如图7-5所示：</p> <p><img src="data:image/gif;base64,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" alt=""></p> <p>图7-5 带附件的周报结构图（浅克隆）</p> <p>附件类Attachment代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">//附件类</span>
<span class="token keyword">class</span> <span class="token class-name">Attachment</span>
<span class="token punctuation">{</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">//附件名</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span>    
       <span class="token punctuation">{</span>   
              <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token operator">=</span> name<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span> 
       <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span> 
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;下载附件，文件名为&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>修改工作周报类WeeklyLog，修改后的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//工作周报WeeklyLog</span>
<span class="token keyword">class</span> <span class="token class-name">WeeklyLog</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span>
<span class="token punctuation">{</span>
     <span class="token comment">//为了简化设计和实现，假设一份工作周报中只有一个附件对象，实际情况中可以包含多个附件，可以通过List等集合对象来实现   </span>
       <span class="token keyword">private</span> <span class="token class-name">Attachment</span> attachment<span class="token punctuation">;</span>
	   <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> date<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAttachment</span><span class="token punctuation">(</span><span class="token class-name">Attachment</span>  attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>attachment <span class="token operator">=</span> attachment<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token operator">=</span> name<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token class-name">String</span> date<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>date  <span class="token operator">=</span> date<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>content  <span class="token operator">=</span> content<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">Attachment</span>  <span class="token function">getAttachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>attachment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	   <span class="token punctuation">}</span>		    
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>   
     <span class="token comment">//使用clone()方法实现浅克隆</span>
       <span class="token keyword">public</span> <span class="token class-name">WeeklyLog</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
       <span class="token punctuation">{</span>
              <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
              <span class="token keyword">try</span>
              <span class="token punctuation">{</span>
                     obj <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">WeeklyLog</span><span class="token punctuation">)</span>obj<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span>  e<span class="token punctuation">)</span> 
              <span class="token punctuation">{</span> 
                     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;不支持复制！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                     <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>    
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>客户端代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span>
<span class="token punctuation">{</span>
       <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token class-name">WeeklyLog</span>  log_previous<span class="token punctuation">,</span> log_new<span class="token punctuation">;</span>
              log_previous  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeeklyLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建原型对象</span>
              <span class="token class-name">Attachment</span>  attachment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建附件对象</span>
              log_previous<span class="token punctuation">.</span><span class="token function">setAttachment</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将附件添加到周报中</span>
              log_new  <span class="token operator">=</span> log_previous<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用克隆方法创建克隆对象</span>
              <span class="token comment">//比较周报</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;周报是否相同？ &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>log_previous <span class="token operator">==</span>  log_new<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//比较附件</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;附件是否相同？ &quot;</span> <span class="token operator">+</span>  <span class="token punctuation">(</span>log_previous<span class="token punctuation">.</span><span class="token function">getAttachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> log_new<span class="token punctuation">.</span><span class="token function">getAttachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>编译并运行程序，输出结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>周报是否相同？  false
附件是否相同？ true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>由于使用的是浅克隆技术，因此工作周报对象复制成功，通过“==”比较原型对象和克隆对象的内存地址时输出false；但是比较附件对象的内存地址时输出true，说明它们在内存中是同一个对象。</p> <p>2.深克隆</p> <p>在深克隆中，无论原型对象的成员变量是值类型还是引用类型，都将复制一份给克隆对象，深克隆将原型对象的所有引用对象也复制一份给克隆对象。简单来说，在深克隆中，除了对象本身被复制外，对象所包含的所有成员变量也将复制，如图7-6所示：</p> <p><img src="data:image/gif;base64,R0lGODlhUQG2AMQAAAAAAP///7W1tXh4eFFRUczMzEBAQI+PjykpKd/f32ZmZhgYGO/v72ZmZqenp7+/v4WFhdfX1zw8PBAQEJmZmebm5vf390pKSiEhIVpaWq2trTMzMwgICHNzcwAAAAAAACH5BAAHAP8ALAAAAABRAbYAAAX/YCCOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSCziHg8BZAkhGJ7QJwdAXUSjCiYEWTB6v+BABHlgKq5QDJWKfl60GqQlTEcVlJDLc+2GI/9/cyIVgIAUTANPG1QTTxlLDwl1k5QkhGVnBgtUCE8dTBSFf5Ijokh4S04GUwAST0saXZU9l4lqG28QAkhhDEgOELYAuBChgrPIOw/ABBIAVp+hDxVhBUipztBbpMktBRQK2Qafkd12SmccHAYDDtzm8CcVGhAGEwAGj7HxJbUGtwoOyIr3oN4wBRQG8nNhoWAGDBMICAwDYYUABiUUTIpAIcOCBQS2YFz44lsHZxIG/wg4VqeAQQNbSOZgoKHDhogU3gWBoECAT58KRjpwaYIAmAodFyBQ4ICazBsuL3BIqbCIBgULNgx48PQHTQUYEAyoysNlgQhoIzgg0aFA2w4RAnQIYLRIBAgbFjB12rUsBAkTmLL0EQErAQp8+wa5uwEBhMQ57hAdIYHE2ooBMFasG4QBhcYQyCru4dmjAtE3HDRGPPpLhAELMqCeQa1Az5+VRRzocJI3gQqbFysIPLu1D88SEFAYPMPCAQyyjddxIEGChh1u0xbgHIBaxQpxg/t4cEG5dDqFMUAYOUMDgg46z4PZbqA4jIAFrB0goSBCWwdcibdDAk4IIN8kwJkXA/8DFxAQ34FhPKAVDra1VYAE+40wV0X5BSBgDgcgcB2ElFQQzoN2IGCgDJgNcsKKJswlBgpcidABeyRUVCMJDJyF1h0nMNBiCb6kNcZaLfwFGQwR7CfAAT2VsGEFQ2VGlw4MENABcymMJIBCZDEAY3cirDdjkHGJMeQI6+1IwgNGImmCA2nOaeRkLBSwwYgWGbCkCWL6BKUIGo1QAJ3++ZibhmsZVUaOEvwFgVpXnlCZAzIaOhCed/aEFqaGWpgfMCVJgCILTjlAAAFuBnCZhyRwVwMDBvCpQhI+SVDbmP1FkJ1ambqqkVGFkSBAB1pKVMGXa9pYQAWLshkrCT6OcZr/rwTUKUF+3MqqQpYUrHAhlypMFmyHsIogKwP7/baWAHUaVZeAPXK7rUtDohsAnnxtSJZbbzarQgQS4PhCQY+JoGpIOZJQWLArWMClBRe02kJd+sol7b5rbiakGDCaZWZoLT7AbQdDfVLCkNyl2aG3lYqQZQwXjFmCBRj8icInEKissaGItoXWomk90MxQvsaF6XtLZRGzW9wqYHLGEcCLlk8ZHevhMondZeQuZ7agAcwr6NxDAhxk4ABLHWTYgn9L5JZxr7+S2l1aBCBwAJwdMtCBAgSEwyrJlHF7gED54Tjpj2sS/HISGd25n8Up4KzzAAKnwNlI58rSoqz+ZVnB/991BjCsuk+3GNrWof7kUwcwOrCWv3LNJaYDrv/kgNst1MxPAmukTUGPEpB7Au4iuKxQppjh6SwBQkY5wlBE3YUnZ0QVFGvuu/G3bxdGXRhX7rmb6YIDGaCAQOllZ1pj52WOwN2j7IpwYSmNJv90T2UsE0DBhsIM9DwkC5/kpz8oq0iLCnCAJ8FOAIWCATi0wAT2CImC5ssMBjN4QQpacIMFWIMIEXABg6kgKIOozfI2hie7YYYBEqiTRibToxZJwCfQ04jUpmW6LuBJIGoZCquGAqPbEACHJowYB1AAACZZ7X4/K1MDIYgbmQ0EAnK6oo24woBwGGo/DDSR3eyHmf/crI5MhJDFAyJovwZCySeZu9UGQBhADG6KjmS0Yx0pKAARBs86LzhAWtr2PRLcECiCap6hIsiANFXpLhihDozqIq8KyIqSZJQZmdzGqqwJ4JBsfAEGHjSBJKJKRsFKWLoqFahc6QKOBkpMbi4yvS6YjC65GUn1CnXGhgGsBIcClq8gJjayVQJ4awhMTXh3H/spJILNw4zreDPF3WmyTAYS0wiAE7+/cFF+IpBbs6gkF7LARXzFkkEpT2AAyrFAdjbi4Sq9ZaIAMFMMgkRnAdgzF6iZTm4y44rU6ISawJ1gnwF4gIzuyYIl/A4AyhwBOGiAsYH4L34cK4qrlrQ3/yD/yqLTIFWIuhA7V+liGn9SVZi6MLMAwCsGCcAACsYWg/xwJlPkjB8DoNWPCDIFBZzhC4eM8h+JKOQASKKOnAaBMt6wz2qY+pHZTmA5ftDEBFV9QQUOJSN9DYlDSpCSLD7xp146pSKik92FxphQGRmNmJgSAAGW6qofxTBpMSAkCnwHg7mCU2HGwsgBOHMXZv7FQLj7ySuVYCAB8OUAIzERF5VQunpm5kk7Gp0E+uPSn+zmJwF5AeaMg74YqGp6KyKEZcQggRoxABg4+uR62OVZ161nWdOrk0NdGhO2jGQZTZleMybnuiPCMZTlKl7ltlUEU5JmBc7lQfekEwwjRJdE/yVIwAauC8NwYRcZFlAAckfThOt+1wga2MCpSBDe35x3Ehfy7oHSa7P3eqGLA3yBBtRjPPv6oAIZYC52E3CBC7DPv0J4jnxhYAEIqMe8CK5BAsBCV+wKAAHRifAPnIOBG9kAOHo5sIZrIFcMLEfDqjFAhUdMgwTABj46sAAFEKCcqbI4Ba9ZwAVsNeIHZIA4N5YBch78g8IsIFIiDrKxOkBjVSpZZp/BgAJ4/GSHHeACQCZCAQaAACnnpMoMJMAELiDIKqMgARQgAAfeYB/7UkkBNIYdHdAMFi+3WToNacIENtABDUDYzBYQwAAkwIGQPODPrfkGnGNDgSSHgc7OGP/H3my8kDHwZAPrGICfzVwDC9DDHhjWxZ3j4QsKJIIDG0CIo5PxgN1oAh8hARCpH3AIAyyiE8UYNaeZBIwL3Jodk45HAeiRgVU0IgsP6O9THkBsAzzDEUuQBqVrMIZWL0EPzj72FnS9ax1YugOvhgITuNCZXywhE5uQQKyTPWJCLOPcT9gEADpxhZCId4NMaIO86c2zXbiz25T4wxISYWtGtAFzFBzAI5hQ7CssAqLQLgYSpl3lagPi0zDB9xZEQXGA98UXotggAebIBAAVgtseb2gcU85yEUy05UTYLcxnLtHx0nwHMr85zF+ucx/kvOcp5znQcb7yoT9Z6EbHwc//k85ppDO9Bkt/+tFtLnUYRL3qN3Y61q1e9K37V+teT1LXw35esJNdBVc/u33NrvYTpL3t32U73HM09rmfR+5291Dd894avNv97Xy/O9UDD/jAG8fvcy+84UeDeLgrfvF9aXzbHw/5p0he7ZSvPEkuf/bMa54fnCe75z8Pj9CHffSk74bpvY761CNj9VtvvesrAXusy372k6h91W+PezroXuq87z0Yfv/04AvfC8RnuvGPX4TkJ335zB+C840O/egHYfpDr771f4B9oGt/+z3ofs+/D/4diF/n5C9/Ds5/8/Sr/wbsp7n731+D+AshE23Iv/73z//+RwEDGOB/AjiA/wSYf3uHDFlSgAq4gP6HAFbAgBDIgAsmAgBgChZ4gRiYgRooCj6xgR74gSBoCg4gU6MhISF4gijogXGQgiyIggdgACbQRJoXU63xADCoeTYYg59HgyV4g5WXgyUgg5XHg4oBhD/ogyMghJBHhH1hhJDnhBS4gyRYhEi4eFAYAEq4eEzYFVcYeFeYhYa3hctWhYb3hVI4A7pQLjbjXjfQhXxnhjM4hS9QGLmDPByjLxhhTDDghnkHh0Mohy5QBrYFI1h0OBCwH6dzBGTohWQIhkCgM3GUGF3nTpNSB2I4MAbCHb1kIB3CFXOhhweziEPQJC3wJXuIApVIB344BBiiWP+JlYZlAjjIIhGUwQISUGEO8B6pAAaXyAIEUC1tkTxLwBtL4B8xYwN8GATO4xRucSwGckOj0gK3OCe62ARgsIpCIGByYUpEgTGfKDOJ9Uk7oo0KE0Fy9gW9uAISAVp1YjJqVRHfqIhFUD4PpAQD1I3s0gEm8zcj8Fq4MY5V4QDmWF9DgI1BcC/JwhsnAUybcSjdaCmGdCjToyJwNEUAVATpWC6OcW66VUjweIw1kIxAcEY44hLAQU6YkALRsi1ykouKZZGI1oaNaAT3siaEtQxtcS8PKQK3BAxlsAS6GBfgU4uoYwQZmQJM0QWDIi0d8pGg6AIiyQNagiwKwBsIQC3/WMQWIZEYPXmITBCU+xIzi/KUyjCTRXAvEqCQvBEt9sQVGPMhj/Eb7EGO/wNHxvVJXnCUx2MjoeVLCPNXMukF3sIdLvElr1WJ1IEhbGJJFTCXVXFITVBFRmCQQFCTJXBJRQmYhFIXhUKXXLEdSGJJeQmILyCQgxVc+pMfaUI8ORCVOzCYWCkX4dEEh2gwgEMo4VQVn+lX3UGWOkCZP6ArtoFDOEQCE/E/1MAuq7IyhTIodGlPobEtxTiaMOALh8gXAplfYlA6CiVBlOOaOhApFBQtRMFAxcKWbNKcGvGcZXAh+LJqPQCcPoCZJeBYJIAAv9VTUVI1/wMmjdUfN9Rx/zmgl3TgbHrhJuCZA5+4VRUxJlBTBn/DZMjCOyayn8/ony4FoPbpBfLZA5z5iS7RKlN0YT6hKjiiEQQTkSWgUNMAZyYSkzdAoGHgbGtwoAkligeZUS7CMYN1UUZhMyi6krqpjyaCAC/KoWY5BNyEMkVpUCdwlW7nFFCam8aiNOt5FtNoF+twBS1CMWjQpdgWBWD6pSPgpVxKo34UG+gpBKSCJ131QncBARupW1KqoiPwUgLZnwSzYj/QoThnT+ODLJp5n/1YKEvlFAJBlwIJLzCUPJGCkQvAcdQiqYZCqfZjqfvCcWjKCFOWoEfwln/lPEVZJYeqG+5ZAosaAY3KWv8HGJJJ2hnsk4rGonFLQJBswh1JgKgIwKdCIKNgQKMRxZM4ygMFsVRTKV5tpDDa8SOrZo2lsKEhwqtB4Kdw56tfEDhU5qlhR61tZ62zoK1ex61q562VAK5bJ65nR64BN6xzh65kp66TYK5Y565hB691IK9VR69eZ6+qyK5wp69bx68R4q9tB7BYJ7DXSLBqZ7BVh7BfgK9Sx7BS57BI+nkS+3QUO5kKe3YXy3QZWwQQ+3RXuKURWLIDGIAmm7IFmByJ1ggq+7In6wowO7O2dgEmYHEtmLMeWIE627MnuF78YA0+O7QfuAAmR7RIOw0H4oj0lwyj9HlM27Sz8LSaF7X/UksJVFt5Vnu1dZC1kLe1XBsGXrt4YBu2XzC2hle2ZmsEaBt4aru2RNC2fPe2cCsEcpt3dFu3QHC3dpe3eusDfDt3fvu3PBC4cDe4hKsDhtt2iJu4OLC4ate4jmsDkHt2kju5NFC5ZHe5mCsDmht2nNu5MPC5Xhe6ousCpLt1pnu6LJC6WLe6rKsCrlt1sBu7KDC7Ule7eiu077ZB+KcJPENBgACjOgcADWEKKNe01nAIENBw8rYBULBwGCQNSBC8WkBwT3APrfAEA9C9SEC831VtP4ltfhQ8+fdw5fuACydt0ecPCDAMBpAFWDRxWnYNS5C966APyfsUw8YTrzZv/55Qq7yQA+4GDP77v51ADvBJdtbpBM+mwPzQEMzgDAHYAQnRGglQEMKgbhInoIthbQbwvsQQCuDbchyRAQjQCBAQBweSwVCCaeywEqSmBFgWgJhTDopxB/47AdDRW0aHZh6xFHQSYXkmFSlhq/dVEzfxBrR0XgngAImADz7cXDLgwW3IZFKGmk8WFYXGGl6wZTdhVEpWEM5GZkCbA+RoMxJpSFYsA/5hBWWWcp6GFRdwYtOKFXO0v+d1LGExAAtMA7pwJwh1hxYFkj7wGXrTxjcGQXpxxjDlYAbgxTB3FwggAcPDA19yl5/UL0+CVAaSiMcBAXqhx1XmGRjQSRQCFv8Q4MgAZxsYMACKXJ/UcFdDs01D8Y4a45sx8BywvHUaYAAGVgMFYGsTaHRCohexfJny9D1qtU/xiB3vUcItd2EDoGwmYCIb8G9JN2MQYM2+uFhshDuHA0G5LF0G8McmIAs7dSsH8ydcQWk6g8SQoc1oZwCs7FIKcnYMMGjonAK98TcXCStNWc46UJXebALdmakncBr/k1CaGDirAlmsYwJSk9BAkxagcjxI8jGFwy1QNAN6cmcDUEIzwNCmcwJosS9zwZ+akh+fsyS28VomUD6UY4waPU30nAIXgsTvpFZZohAc0gUKZMg0oFcz0AEV0EBt8xOW8I3fkSNmkVAFIRr/q7NDmhJAI1A1aPEfcOErhnQnuhwk6rUC1UVRadEra9ITRKEAieGe2+I3LaVRh7gyUD0CIwolr9SXHjKiEETKWcLTOp0mzWAwHLJGnLR+g+eLbEJSd/oTefOKBnIXCckqUR1OZhC8dcJAnsVMf1mYJnBIoGUlLYYAxlPWMwAgTuEtaPELbWMynIU60HMXMYMKcjqMqQSMVREedGFCWGQkwdhpFUMDmAIgWnJLVqIvTbKmMVABGxDLf7EvSPPRGgKaP8UWBOQqlZ06YrAjamEkauEmQcEh8ChN5FOi2skimRMBG3DQJ9BJsHNE52icf3MAiaEEkeIYj8IZvVQXieEL/2+SGIzpMXvzJqXTBVVCA+rN3gnlE13TQDyCIzL9AhlwADoxXTPwWuETvNGiUBjRnNGiEasTIAMRQyY5F0Y9GRnSSyPDMXHx2h4CS8cizTIzASigNiHJXMxTFaKmQL/oPZik3wNRF7rCJny9ySPAS5VSlZmhFh4ttGdhAwjBD2owDBROKMV8MFeiL3UhJmkCi2GpG+HBRScRL7Dd0Fht5mfEFQAiSL7SWlLS5miR2C6wAH9C5zXQnnTBBD0uAkpADahpG3btloOQolJERZOyRnW9HZkpEA4kV6e1I6HhUWoB2C1QWvEw5WuwAQeQAVfeV/syorlUXOC8HxXAF2wI1P/xI15LRRSied0lING/3TAtRUwzYOc6aANVPUjqHCtClTxJtVDM4x2E0ASS6EMCNNNpYtJsAhRuRMp3ygoilCkWIG/RXqbUvgbSfu1UkO3l2wGY7kfK/QLhE+TtrU1E8kCHZIfQnVEXxufJsx+i5lJJxBthQlB3xVALQuMnYOuA3AU5LjNFIxHagREM0CNw7h9kftL/IyMjsTr6mJnGWU4mkNduROnvlD6XLkJp4w4YoOAaFUzYEiNCydZA5Xb7ggD7SB2kGCrdQToILV73BOolavEqYOElYONQ1wW30dcTHyAmJNgLLSSVsR2VsSME/xtY9CcEc09cLumAfgNRnvH/G38Mo1UD2SI7P6IljoTU23Q0IOPYirVQMiMASBIBWiKMvIOXg6AENWI0hnY3WY/RtO4CDGCkKJDgOR9FoSGJcqIlosEZ9skLSaA9n4SrEfQAKmIJj8ITWlzXPGkDeB8PKMMlBEBlJYFjqJHMJRABfxJZSdbPMmABz5kjAwB1guJZ1hREkIEp1GAyy8qsrpLVbiLRy9AqEV77qMowrfQktgX67BXcxmEBtJh3CWAAlG7advfX8mEByKL5MKcaozbSMk5zO00i7tHNZzfMGRCTF9bpVbfPMfRd+6wcHs9ytpHNtKEA6B923Fz+MjFh6uH8QSYAvub9LjDMG2D/N3fM/yQfYSDGmyAQiCNZmieaqivbqsmAXYLbFgoGJTXf+z/whhlUgMbjUZOZKBwMJDQKLUA2uZ2UlIBgDJRiNix2RSAICeU5XmcZlOUFUmDToRWHYrEZzOuiR96GnB/hkUAHBsJARGGjkcCABMfFwYPjpUgCHsJCxhemSMHAxgTBQR8o5gOEAQAlVmpsi8Vh64YCxYOFbFSEAMTFBIYnI+8Ig0YHaZyAmrGU5kCrAYTl87UNhYIBx4SBAoQAKjYJwwMF8AYAArMzeflvcNdANew7SsHvtnBG9f1/C3PoLqhDQA1CtQfj/FR4cA5hBm7ewIkD6CLBKmkYAEggACEXGGMRHo4cYIUAwIY4udxZbElmFUIDBiQAAODNgEeEOsM57OmzJ7qdEDrIVAdggUxwEBzocjlFA4RtC2oaNNABoQCHUho+cIBwm4Gp66xWK+b0bBuHUIUCk+n2rVulOyspRHtpJEmEF2TW7NuXA1y3Rv3WRGqg30eHIe0ybuz4nYWfPRc+rmz5MubMmjdz7uz5s+YQADs=" alt=""></p> <p>图7-6 深克隆示意图</p> <p>在Java语言中，如果需要实现深克隆，可以通过序列化(Serialization)等方式来实现。序列化就是将对象写到流的过程，写到流中的对象是原有对象的一个拷贝，而原对象仍然存在于内存中。通过序列化实现的拷贝不仅可以复制对象本身，而且可以复制其引用的成员对象，因此通过序列化将对象写到一个流中，再从流里将其读出来，可以实现深克隆。需要注意的是能够实现序列化的对象其类必须实现Serializable接口，否则无法实现序列化操作。下面我们使用深克隆技术来实现工作周报和附件对象的复制，由于要将附件对象和工作周报对象都写入流中，因此两个类均需要实现Serializable接口，其结构如图7-7所示：</p> <p><img src="/assets/img/s33.93274b40.gif" alt=""></p> <p>图7-7 带附件的周报结构图（深克隆）</p> <p>修改后的附件类Attachment代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span>  <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token comment">//附件类</span>
<span class="token keyword">class</span>  <span class="token class-name">Attachment</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
<span class="token punctuation">{</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">//附件名</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token operator">=</span> name<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;下载附件，文件名为&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>工作周报类WeeklyLog不再使用Java自带的克隆机制，而是通过序列化来从头实现对象的深克隆，我们需要重新编写clone()方法，修改后的代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span>  <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token comment">//工作周报类</span>
<span class="token keyword">class</span>  <span class="token class-name">WeeklyLog</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
<span class="token punctuation">{</span>
       <span class="token keyword">private</span>  <span class="token class-name">Attachment</span> attachment<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> name<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> date<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> content<span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setAttachment</span><span class="token punctuation">(</span><span class="token class-name">Attachment</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>attachment  <span class="token operator">=</span> attachment<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token operator">=</span> name<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token class-name">String</span> date<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>date  <span class="token operator">=</span> date<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>content  <span class="token operator">=</span> content<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">Attachment</span> <span class="token function">getAttachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>attachment<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> 
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token comment">//使用序列化技术实现深克隆</span>
       <span class="token keyword">public</span> <span class="token class-name">WeeklyLog</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">OptionalDataException</span>
       <span class="token punctuation">{</span>
              <span class="token comment">//将对象写入流中</span>
              <span class="token class-name">ByteArrayOutputStream</span> bao<span class="token operator">=</span><span class="token keyword">new</span>  <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">ObjectOutputStream</span> oos<span class="token operator">=</span><span class="token keyword">new</span>  <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">)</span><span class="token punctuation">;</span>
              oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//将对象从流中取出</span>
              <span class="token class-name">ByteArrayInputStream</span> bis<span class="token operator">=</span><span class="token keyword">new</span>  <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">ObjectInputStream</span> ois<span class="token operator">=</span><span class="token keyword">new</span>  <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>bis<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token class-name">WeeklyLog</span><span class="token punctuation">)</span>ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>客户端代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span>
<span class="token punctuation">{</span>
       <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token class-name">WeeklyLog</span>  log_previous<span class="token punctuation">,</span> log_new <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
              log_previous  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeeklyLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建原型对象</span>
              <span class="token class-name">Attachment</span>  attachment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建附件对象</span>
              log_previous<span class="token punctuation">.</span><span class="token function">setAttachment</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将附件添加到周报中</span>
              <span class="token keyword">try</span>
              <span class="token punctuation">{</span>
                     log_new <span class="token operator">=</span>  log_previous<span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用深克隆方法创建克隆对象                  </span>
              <span class="token punctuation">}</span>
              <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
                         <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;克隆失败！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token comment">//比较周报</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;周报是否相同？ &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>log_previous <span class="token operator">==</span>  log_new<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//比较附件    </span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;附件是否相同？ &quot;</span> <span class="token operator">+</span>  <span class="token punctuation">(</span>log_previous<span class="token punctuation">.</span><span class="token function">getAttachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> log_new<span class="token punctuation">.</span><span class="token function">getAttachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>编译并运行程序，输出结果如下：</p> <div class="language- extra-class"><pre><code>周报是否相同？  false
附件是否相同？  false   
</code></pre></div><p>从输出结果可以看出，由于使用了深克隆技术，附件对象也得以复制，因此用“==”比较原型对象的附件和克隆对象的附件时输出结果均为false。深克隆技术实现了原型对象和克隆对象的完全独立，对任意克隆对象的修改都不会给其他对象产生影响，是一种更为理想的克隆实现方式。</p> <h4 id="_5-原型管理器的引入和实现"><a href="#_5-原型管理器的引入和实现" class="header-anchor">#</a> 5 原型管理器的引入和实现</h4> <p>​      原型管理器(Prototype Manager)是将多个原型对象存储在一个集合中供客户端使用，它是一个专门负责克隆对象的工厂，其中定义了一个集合用于存储原型对象，如果需要某个原型对象的一个克隆，可以通过复制集合中对应的原型对象来获得。在原型管理器中针对抽象原型类进行编程，以便扩展。其结构如图7-8所示：</p> <p><img src="data:image/gif;base64,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" alt=""></p> <h4 id="_6-原型模式总结"><a href="#_6-原型模式总结" class="header-anchor">#</a> 6 原型模式总结</h4> <p>​      原型模式作为一种快速创建大量相同或相似对象的方式，在软件开发中应用较为广泛，很多软件提供的复制(Ctrl + C)和粘贴(Ctrl + V)操作就是原型模式的典型应用，下面对该模式的使用效果和适用情况进行简单的总结。</p> <p>1.主要优点</p> <p>(1) 当创建新的对象实例较为复杂时，使用原型模式可以简化对象的创建过程，通过复制一个已有实例可以提高新实例的创建效率。</p> <p>(2) 扩展性较好，由于在原型模式中提供了抽象原型类，在客户端可以针对抽象原型类进行编程，而将具体原型类写在配置文件中，增加或减少产品类对原有系统都没有任何影响。</p> <p>(3) 原型模式提供了简化的创建结构，工厂方法模式常常需要有一个与产品类等级结构相同的工厂等级结构，而原型模式就不需要这样，原型模式中产品的复制是通过封装在原型类中的克隆方法实现的，无须专门的工厂类来创建产品。</p> <p>(4) 可以使用深克隆的方式保存对象的状态，使用原型模式将对象复制一份并将其状态保存起来，以便在需要的时候使用（如恢复到某一历史状态），可辅助实现撤销操作。</p> <p>2.主要缺点</p> <p>(1) 需要为每一个类配备一个克隆方法，而且该克隆方法位于一个类的内部，当对已有的类进行改造时，需要修改源代码，违背了“开闭原则”。</p> <p>(2) 在实现深克隆时需要编写较为复杂的代码，而且当对象之间存在多重的嵌套引用时，为了实现深克隆，每一层对象对应的类都必须支持深克隆，实现起来可能会比较麻烦。</p> <p>3.适用场景</p> <p>(1) 创建新对象成本较大（如初始化需要占用较长的时间，占用太多的CPU资源或网络资源），新的对象可以通过原型模式对已有对象进行复制来获得，如果是相似对象，则可以对其成员变量稍作修改。</p> <p>(2) 如果系统要保存对象的状态，而对象的状态变化很小，或者对象本身占用内存较少时，可以使用原型模式配合备忘录模式来实现。</p> <p>(3) 需要避免使用分层次的工厂类来创建分层次的对象，并且类的实例对象只有一个或很少的几个组合状态，通过复制原型对象得到新实例可能比使用构造函数创建一个新实例更加方便。</p> <h3 id="建造者模式-生成器模式"><a href="#建造者模式-生成器模式" class="header-anchor">#</a> 建造者模式（生成器模式）</h3> <p>没有人买车会只买一个轮胎或者方向盘，大家买的都是一辆包含轮胎、方向盘和发动机等多个部件的完整汽车。如何将这些部件组装成一辆完整的汽车并返回给用户，这是建造者模式需要解决的问题。建造者模式又称为生成器模式，它是一种较为复杂、使用频率也相对较低的创建型模式。建造者模式为客户端返回的不是一个简单的产品，而是一个由多个部件组成的复杂产品。</p> <h4 id="_1-建造者模式概述"><a href="#_1-建造者模式概述" class="header-anchor">#</a> 1 建造者模式概述</h4> <p>建造者模式是较为复杂的创建型模式，它将客户端与包含多个组成部分（或部件）的复杂对象的创建过程分离，客户端无须知道复杂对象的内部组成部分与装配方式，只需要知道所需建造者的类型即可。它关注如何一步一步创建一个的复杂对象，不同的具体建造者定义了不同的创建过程，且具体建造者相互独立，增加新的建造者非常方便，无须修改已有代码，系统具有较好的扩展性。</p> <p>建造者模式定义如下：</p> <p>建造者模式(Builder Pattern)：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。建造者模式是一种对象创建型模式。</p> <p>建造者模式一步一步创建一个复杂的对象，它允许用户只通过指定复杂对象的类型和内容就可以构建它们，用户不需要知道内部的具体构建细节。建造者模式结构如图8-2所示：</p> <p><img src="/assets/img/s35.fb1b7032.gif" alt=""></p> <p><strong>图8-2</strong>建造者模式结构图</p> <p>在建造者模式结构图中包含如下几个角色：</p> <p>● Builder（抽象建造者）：它为创建一个产品Product对象的各个部件指定抽象接口，在该接口中一般声明两类方法，一类方法是buildPartX()，它们用于创建复杂对象的各个部件；另一类方法是getResult()，它们用于返回复杂对象。Builder既可以是抽象类，也可以是接口。</p> <p>●ConcreteBuilder（具体建造者）：它实现了Builder接口，实现各个部件的具体构造和装配方法，定义并明确它所创建的复杂对象，也可以提供一个方法返回创建好的复杂产品对象。</p> <p>●Product（产品角色）：它是被构建的复杂对象，包含多个组成部件，具体建造者创建该产品的内部表示并定义它的装配过程。</p> <p>● Director（指挥者）：指挥者又称为导演类，它负责安排复杂对象的建造次序，指挥者与抽象建造者之间存在关联关系，可以在其construct()建造方法中调用建造者对象的部件构造与装配方法，完成复杂对象的建造。客户端一般只需要与指挥者进行交互，在客户端确定具体建造者的类型，并实例化具体建造者对象（也可以通过配置文件和反射机制），然后通过指挥者类的构造函数或者Setter方法将该对象传入指挥者类中。</p> <p>在建造者模式的定义中提到了复杂对象，那么什么是复杂对象？简单来说，复杂对象是指那些包含多个成员属性的对象，这些成员属性也称为部件或零件，如汽车包括方向盘、发动机、轮胎等部件，电子邮件包括发件人、收件人、主题、内容、附件等部件，一个典型的复杂对象类代码示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Product</span>  <span class="token punctuation">{</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> partA<span class="token punctuation">;</span> <span class="token comment">//定义部件，部件可以是任意类型，包括值类型和引用类型</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> partB<span class="token punctuation">;</span>
       <span class="token keyword">private</span>  <span class="token class-name">String</span> partC<span class="token punctuation">;</span>
       <span class="token comment">//partA的Getter方法和Setter方法省略</span>
       <span class="token comment">//partB的Getter方法和Setter方法省略</span>
       <span class="token comment">//partC的Getter方法和Setter方法省略</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在抽象建造者类中定义了产品的创建方法和返回方法，其典型代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span>
     <span class="token comment">//创建产品对象</span>
       <span class="token keyword">protected</span>  <span class="token class-name">Product</span> product<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildPartA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildPartB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildPartC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//返回产品对象</span>
       <span class="token keyword">public</span>  <span class="token class-name">Product</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  product<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在抽象类Builder中声明了一系列抽象的buildPartX()方法用于创建复杂产品的各个部件，具体建造过程在ConcreteBuilder中实现，此外还提供了工厂方法getResult()，用于返回一个建造好的完整产品。</p> <p>在ConcreteBuilder中实现了buildPartX()方法，通过调用Product的setPartX()方法可以给产品对象的成员属性设值。不同的具体建造者在实现buildPartX()方法时将有所区别，如setPartX()方法的参数可能不一样，在有些具体建造者类中某些setPartX()方法无须实现（提供一个空实现）。而这些对于客户端来说都无须关心，客户端只需知道具体建造者类型即可。</p> <p>在建造者模式的结构中还引入了一个指挥者类Director，该类主要有两个作用：一方面它隔离了客户与创建过程；另一方面它控制产品的创建过程，包括某个buildPartX()方法是否被调用以及多个buildPartX()方法调用的先后次序等。指挥者针对抽象建造者编程，客户端只需要知道具体建造者的类型，即可通过指挥者类调用建造者的相关方法，返回一个完整的产品对象。在实际生活中也存在类似指挥者一样的角色，如一个客户去购买电脑，电脑销售人员相当于指挥者，只要客户确定电脑的类型，电脑销售人员可以通知电脑组装人员给客户组装一台电脑。指挥者类的代码示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token punctuation">{</span>
       <span class="token keyword">private</span>  <span class="token class-name">Builder</span> builder<span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>builder<span class="token operator">=</span>builder<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">setBuilder</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>builder<span class="token operator">=</span>builer<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token comment">//产品构建与组装方法</span>
       <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              builder<span class="token punctuation">.</span><span class="token function">buildPartA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              builder<span class="token punctuation">.</span><span class="token function">buildPartB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              builder<span class="token punctuation">.</span><span class="token function">buildPartC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在指挥者类中可以注入一个抽象建造者类型的对象，其核心在于提供了一个建造方法construct()，在该方法中调用了builder对象的构造部件的方法，最后返回一个产品对象。</p> <p>对于客户端而言，只需关心具体的建造者即可，一般情况下，客户端类代码片段如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Builder</span>  builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可通过配置文件实现</span>

<span class="token class-name">Director</span> director <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token class-name">Director</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Product</span> product <span class="token operator">=</span> director<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以通过配置文件来存储具体建造者类ConcreteBuilder的类名，使得更换新的建造者时无须修改源代码，系统扩展更为方便。在客户端代码中，无须关心产品对象的具体组装过程，只需指定具体建造者的类型即可。</p> <p>建造者模式与抽象工厂模式有点相似，但是建造者模式返回一个完整的复杂产品，而抽象工厂模式返回一系列相关的产品；在抽象工厂模式中，客户端通过选择具体工厂来生成所需对象，而在建造者模式中，客户端通过指定具体建造者类型并指导Director类如何去生成对象，侧重于一步步构造一个复杂对象，然后将结果返回。如果将抽象工厂模式看成一个汽车配件生产厂，生成不同类型的汽车配件，那么建造者模式就是一个汽车组装厂，通过对配件进行组装返回一辆完整的汽车。</p> <h4 id="_2-案例"><a href="#_2-案例" class="header-anchor">#</a> 2 案例</h4> <p>Sunny公司开发人员决定使用建造者模式来实现游戏角色的创建，其基本结构如图8-3所示：</p> <p><img src="/assets/img/s36.b5390c5a.gif" alt=""></p> <p>在图8-3中，ActorController充当指挥者，ActorBuilder充当抽象建造者，HeroBuilder、AngelBuilder和DevilBuilder充当具体建造者，Actor充当复杂产品。完整代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token comment">//Actor角色类：复杂产品，考虑到代码的可读性，只列出部分成员属性，且成员属性的类型均为String，真实情况下，有些成员属性的类型需自定义</span>

<span class="token keyword">class</span> <span class="token class-name">Actor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span> <span class="token comment">//角色类型</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span> <span class="token comment">//性别</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> face<span class="token punctuation">;</span> <span class="token comment">//脸型</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> costume<span class="token punctuation">;</span> <span class="token comment">//服装</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> hairstyle<span class="token punctuation">;</span> <span class="token comment">//发型</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> type<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span><span class="token class-name">String</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> face<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFace</span><span class="token punctuation">(</span><span class="token class-name">String</span> face<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>face <span class="token operator">=</span> face<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> costume<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCostume</span><span class="token punctuation">(</span><span class="token class-name">String</span> costume<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>costume <span class="token operator">=</span> costume<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> hairstyle<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHairstyle</span><span class="token punctuation">(</span><span class="token class-name">String</span> hairstyle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hairstyle <span class="token operator">=</span> hairstyle<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//角色建造器：抽象建造者</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ActorBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Actor</span> actor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//工厂方法，返回一个完整的游戏角色对象</span>
    <span class="token keyword">public</span> <span class="token class-name">Actor</span> <span class="token function">createActor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> actor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//英雄角色建造器：具体建造者</span>
<span class="token keyword">class</span> <span class="token class-name">HeroBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">ActorBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;英雄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setFace</span><span class="token punctuation">(</span><span class="token string">&quot;英俊&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setCostume</span><span class="token punctuation">(</span><span class="token string">&quot;盔甲&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setHairstyle</span><span class="token punctuation">(</span><span class="token string">&quot;飘逸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//天使角色建造器：具体建造者</span>
<span class="token keyword">class</span> <span class="token class-name">AngelBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">ActorBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;天使&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setFace</span><span class="token punctuation">(</span><span class="token string">&quot;漂亮&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setCostume</span><span class="token punctuation">(</span><span class="token string">&quot;白裙&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setHairstyle</span><span class="token punctuation">(</span><span class="token string">&quot;披肩长发&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//恶魔角色建造器：具体建造者</span>
<span class="token keyword">class</span> <span class="token class-name">DevilBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">ActorBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;恶魔&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;妖&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setFace</span><span class="token punctuation">(</span><span class="token string">&quot;丑陋&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setCostume</span><span class="token punctuation">(</span><span class="token string">&quot;黑衣&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actor<span class="token punctuation">.</span><span class="token function">setHairstyle</span><span class="token punctuation">(</span><span class="token string">&quot;光头&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br></div></div><p>指挥者类ActorController定义了construct()方法，该方法拥有一个抽象建造者ActorBuilder类型的参数，在该方法内部实现了游戏角色对象的逐步构建，代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//游戏角色创建控制器：指挥者</span>
<span class="token keyword">class</span> <span class="token class-name">ActorController</span>
<span class="token punctuation">{</span>
    <span class="token comment">//逐步构建复杂产品对象</span>
       <span class="token keyword">public</span> <span class="token class-name">Actor</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token class-name">ActorBuilder</span> ab<span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token class-name">Actor</span> actor<span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              actor<span class="token operator">=</span>ab<span class="token punctuation">.</span><span class="token function">createActor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> actor<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>为了提高系统的灵活性和可扩展性，我们将具体建造者类的类名存储在配置文件中，并通过工具类XMLUtil来读取配置文件并反射生成对象，XMLUtil类的代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>w3c<span class="token punctuation">.</span>dom<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>sax<span class="token punctuation">.</span></span><span class="token class-name">SAXException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">XMLUtil</span>
<span class="token punctuation">{</span>
<span class="token comment">//该方法用于从XML配置文件中提取具体类类名，并返回一个实例对象</span>
       <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token keyword">try</span>
              <span class="token punctuation">{</span>
                     <span class="token comment">//创建文档对象</span>
                     <span class="token class-name">DocumentBuilderFactory</span>  dFactory <span class="token operator">=</span> <span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token class-name">DocumentBuilder</span>  builder <span class="token operator">=</span> dFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token class-name">Document</span>  doc<span class="token punctuation">;</span>                                                
                     doc  <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">//获取包含类名的文本节点</span>
                     <span class="token class-name">NodeList</span>  nl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Node</span>  classNode<span class="token operator">=</span>nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span>  cName<span class="token operator">=</span>classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//通过类名生成实例对象并将其返回</span>
            <span class="token class-name">Class</span> c<span class="token operator">=</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token class-name">Object</span> obj<span class="token operator">=</span>c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>  
         <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
         <span class="token punctuation">{</span>
              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>配置文件</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>config<span class="token punctuation">&gt;</span></span>
       <span class="token generics"><span class="token punctuation">&lt;</span>className<span class="token punctuation">&gt;</span></span><span class="token class-name">AngelBuilder</span><span class="token operator">&lt;</span><span class="token operator">/</span>className<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>config<span class="token operator">&gt;</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>客户端测试代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span>
<span class="token punctuation">{</span>
       <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token class-name">ActorBuilder</span> ab<span class="token punctuation">;</span> <span class="token comment">//针对抽象建造者编程</span>
              ab <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">ActorBuilder</span><span class="token punctuation">)</span><span class="token class-name">XMLUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//反射生成具体建造者对象</span>
         <span class="token class-name">ActorController</span> ac <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token class-name">ActorController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">Actor</span> actor<span class="token punctuation">;</span>
              actor <span class="token operator">=</span> ac<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过指挥者创建完整的建造者对象</span>
              <span class="token class-name">String</span>  type <span class="token operator">=</span> actor<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>type  <span class="token operator">+</span> <span class="token string">&quot;的外观：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;性别：&quot;</span> <span class="token operator">+</span> actor<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;面容：&quot;</span> <span class="token operator">+</span> actor<span class="token punctuation">.</span><span class="token function">getFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;服装：&quot;</span> <span class="token operator">+</span> actor<span class="token punctuation">.</span><span class="token function">getCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;发型：&quot;</span> <span class="token operator">+</span> actor<span class="token punctuation">.</span><span class="token function">getHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_3-director"><a href="#_3-director" class="header-anchor">#</a> 3 Director</h4> <p>指挥者类Director在建造者模式中扮演非常重要的作用，简单的Director类用于指导具体建造者如何构建产品，它按一定次序调用Builder的buildPartX()方法，控制调用的先后次序，并向客户端返回一个完整的产品对象。下面我们讨论几种Director的高级应用方式：</p> <ol><li>省略Director</li></ol> <p>在有些情况下，为了简化系统结构，可以将Director和抽象建造者Builder进行合并，在Builder中提供逐步构建复杂产品对象的construct()方法。由于Builder类通常为抽象类，因此可以将construct()方法定义为静态(static)方法。如果将游戏角色设计中的指挥者类ActorController省略，ActorBuilder类的代码修改如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ActorBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Actor</span> actor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Actor</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token class-name">ActorBUilder</span> ab<span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              ab<span class="token punctuation">.</span><span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> actor<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>客户端代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ActorBuilder</span> ab<span class="token punctuation">;</span> 
ab <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">ActorBuilder</span><span class="token punctuation">)</span><span class="token class-name">XMLUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Actor</span> actor<span class="token punctuation">;</span>
actor <span class="token operator">=</span> <span class="token class-name">ActorBuilder</span><span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以将construct()方法的参数去掉，直接在construct()方法中调用buildPartX()方法，代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ActorBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Actor</span> actor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Actor</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> actor<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>客户端代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ActorBuilder</span> ab<span class="token punctuation">;</span> 
ab <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">ActorBuilder</span><span class="token punctuation">)</span><span class="token class-name">XMLUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Actor</span> actor<span class="token punctuation">;</span>
actor <span class="token operator">=</span> ab<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>此时，construct()方法定义了其他buildPartX()方法调用的次序，为其他方法的执行提供了一个流程模板，这与我们在后面要学习的模板方法模式非常类似。</p> <p>以上两种对Director类的省略方式都不影响系统的灵活性和可扩展性，同时还简化了系统结构，但加重了抽象建造者类的职责，如果construct()方法较为复杂，待构建产品的组成部分较多，建议还是将construct()方法单独封装在Director中，这样做更符合“单一职责原则”。</p> <ol start="2"><li>钩子方法</li></ol> <p>建造者模式除了逐步构建一个复杂产品对象外，还可以通过Director类来更加精细地控制产品的创建过程，例如增加一类称之为钩子方法(HookMethod)的特殊方法来控制是否对某个buildPartX()的调用。</p> <p>钩子方法的返回类型通常为boolean类型，方法名一般为isXXX()，钩子方法定义在抽象建造者类中。例如我们可以在游戏角色的抽象建造者类ActorBuilder中定义一个方法isBareheaded()，用于判断某个角色是否为“光头(Bareheaded)”，在ActorBuilder为之提供一个默认实现，其返回值为false，代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ActorBuilder</span>
<span class="token punctuation">{</span>
       <span class="token keyword">protected</span>  <span class="token class-name">Actor</span> actor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//钩子方法</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isBareheaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
		     <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token class-name">Actor</span> <span class="token function">createActor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token keyword">return</span>  actor<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>如果某个角色无须构建头发部件，例如“恶魔(Devil)”，则对应的具体建造器DevilBuilder将覆盖isBareheaded()方法，并将返回值改为true，代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">DevilBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">ActorBuilder</span>
<span class="token punctuation">{</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              actor<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;恶魔&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              actor<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;妖&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              actor<span class="token punctuation">.</span><span class="token function">setFace</span><span class="token punctuation">(</span><span class="token string">&quot;丑陋&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              actor<span class="token punctuation">.</span><span class="token function">setCostume</span><span class="token punctuation">(</span><span class="token string">&quot;黑衣&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              actor<span class="token punctuation">.</span><span class="token function">setHairstyle</span><span class="token punctuation">(</span><span class="token string">&quot;光头&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token comment">//覆盖钩子方法</span>
       <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isBareheaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>     
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>指挥者代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ActorController</span>
<span class="token punctuation">{</span>
       <span class="token keyword">public</span>  <span class="token class-name">Actor</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token class-name">ActorBuilder</span> ab<span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
              <span class="token class-name">Actor</span>  actor<span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              ab<span class="token punctuation">.</span><span class="token function">buildCostume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//通过钩子方法来控制产品的构建</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ab<span class="token punctuation">.</span><span class="token function">isBareheaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
                     ab<span class="token punctuation">.</span> <span class="token function">buildHairstyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              actor<span class="token operator">=</span>ab<span class="token punctuation">.</span><span class="token function">createActor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span>  actor<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>当在客户端代码中指定具体建造者类型并通过指挥者来实现产品的逐步构建时，将调用钩子方法isBareheaded()来判断游戏角色是否有头发，如果isBareheaded()方法返回true，即没有头发，则跳过构建发型的方法buildHairstyle()；否则将执行buildHairstyle()方法。通过引入钩子方法，我们可以在Director中对复杂产品的构建进行精细的控制，不仅指定buildPartX()方法的执行顺序，还可以控制是否需要执行某个buildPartX()方法。</p> <h4 id="_4-总结"><a href="#_4-总结" class="header-anchor">#</a> 4 总结</h4> <p>建造者模式的核心在于如何一步步构建一个包含多个组成部件的完整对象，使用相同的构建过程构建不同的产品，在软件开发中，如果我们需要创建复杂对象并希望系统具备很好的灵活性和可扩展性可以考虑使用建造者模式。</p> <p>1.主要优点</p> <p>(1) 在建造者模式中，客户端不必知道产品内部组成的细节，将产品本身与产品的创建过程解耦，使得相同的创建过程可以创建不同的产品对象。</p> <p>(2) 每一个具体建造者都相对独立，而与其他的具体建造者无关，因此可以很方便地替换具体建造者或增加新的具体建造者，用户使用不同的具体建造者即可得到不同的产品对象。由于指挥者类针对抽象建造者编程，增加新的具体建造者无须修改原有类库的代码，系统扩展方便，符合“开闭原则”</p> <p>(3) 可以更加精细地控制产品的创建过程。将复杂产品的创建步骤分解在不同的方法中，使得创建过程更加清晰，也更方便使用程序来控制创建过程。</p> <p>2.主要缺点</p> <p>(1) 建造者模式所创建的产品一般具有较多的共同点，其组成部分相似，如果产品之间的差异性很大，例如很多组成部分都不相同，不适合使用建造者模式，因此其使用范围受到一定的限制。</p> <p>(2) 如果产品的内部变化复杂，可能会导致需要定义很多具体建造者类来实现这种变化，导致系统变得很庞大，增加系统的理解难度和运行成本。</p> <p>3.适用场景</p> <p>(1) 需要生成的产品对象有复杂的内部结构，这些产品对象通常包含多个成员属性。</p> <p>(2) 需要生成的产品对象的属性相互依赖，需要指定其生成顺序。</p> <p>(3) 对象的创建过程独立于创建该对象的类。在建造者模式中通过引入了指挥者类，将创建过程封装在指挥者类中，而不在建造者类和客户类中。</p> <p>(4) 隔离复杂对象的创建和使用，并使得相同的创建过程可以创建不同的产品</p> <h2 id="工厂方法模式"><a href="#工厂方法模式" class="header-anchor">#</a> 工厂方法模式</h2> <h4 id="_1-日志记录器的设计"><a href="#_1-日志记录器的设计" class="header-anchor">#</a> 1 日志记录器的设计</h4> <div class="language- extra-class"><pre><code>   Sunny软件公司欲开发一个系统运行日志记录器(Logger)，该记录器可以通过多种途径保存系统的运行日志，如通过文件记录或数据库记录，用户可以通过修改配置文件灵活地更换日志记录方式。在设计各类日志记录器时，Sunny公司的开发人员发现需要对日志记录器进行一些初始化工作，初始化参数的设置过程较为复杂，而且某些参数的设置有严格的先后次序，否则可能会发生记录失败。如何封装记录器的初始化过程并保证多种记录器切换的灵活性是Sunny公司开发人员面临的一个难题。

Sunny公司的开发人员通过对该需求进行分析，发现该日志记录器有两个设计要点：
</code></pre></div><p>(1) 需要封装日志记录器的初始化过程，这些初始化工作较为复杂，例如需要初始化其他相关的类，还有可能需要读取配置文件（例如连接数据库或创建文件），导致代码较长，如果将它们都写在构造函数中，会导致构造函数庞大，不利于代码的修改和维护；</p> <p>(2) 用户可能需要更换日志记录方式，在客户端代码中需要提供一种灵活的方式来选择日志记录器，尽量在不修改源代码的基础上更换或者增加日志记录方式。</p> <p>Sunny公司开发人员最初使用简单工厂模式对日志记录器进行了设计，初始结构如图1所示：</p> <p><img src="/assets/img/s37.f3b4c866.jpg" alt=""></p> <p>图1 基于简单工厂模式设计的日志记录器结构图</p> <p>在图1中，LoggerFactory充当创建日志记录器的工厂，提供了工厂方法createLogger()用于创建日志记录器，Logger是抽象日志记录器接口，其子类为具体日志记录器。其中，工厂类LoggerFactory代码片段如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//日志记录器工厂</span>
<span class="token keyword">class</span> <span class="token class-name">LoggerFactory</span> <span class="token punctuation">{</span>
    <span class="token comment">//静态工厂方法</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Logger</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//连接数据库，代码省略</span>
			<span class="token comment">//创建数据库日志记录器对象</span>
			<span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
			<span class="token comment">//初始化数据库日志记录器，代码省略</span>
			<span class="token keyword">return</span> logger<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//创建日志文件</span>
			<span class="token comment">//创建文件日志记录器对象</span>
			<span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
			<span class="token comment">//初始化文件日志记录器，代码省略</span>
			<span class="token keyword">return</span> logger<span class="token punctuation">;</span>			
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>为了突出设计重点，我们对上述代码进行了简化，省略了具体日志记录器类的初始化代码。在LoggerFactory类中提供了静态工厂方法createLogger()，用于根据所传入的参数创建各种不同类型的日志记录器。通过使用简单工厂模式，我们将日志记录器对象的创建和使用分离，客户端只需使用由工厂类创建的日志记录器对象即可，无须关心对象的创建过程，但是我们发现，虽然简单工厂模式实现了对象的创建和使用分离，但是仍然存在如下两个问题：</p> <p>(1) 工厂类过于庞大，包含了大量的if…else…代码，导致维护和测试难度增大；</p> <p>(2) 系统扩展不灵活，如果增加新类型的日志记录器，必须修改静态工厂方法的业务逻辑，违反了“开闭原则”。</p> <p>如何解决这两个问题，提供一种简单工厂模式的改进方案？这就是本文所介绍的工厂方法模式的动机之一。</p> <h4 id="_2-工厂方法模式概述"><a href="#_2-工厂方法模式概述" class="header-anchor">#</a> 2 工厂方法模式概述</h4> <p>在简单工厂模式中只提供一个工厂类，该工厂类处于对产品类进行实例化的中心位置，它需要知道每一个产品对象的创建细节，并决定何时实例化哪一个产品类。简单工厂模式最大的缺点是当有新产品要加入到系统中时，必须修改工厂类，需要在其中加入必要的业务逻辑，这违背了“开闭原则”。此外，在简单工厂模式中，所有的产品都由同一个工厂创建，工厂类职责较重，业务逻辑较为复杂，具体产品与工厂类之间的耦合度高，严重影响了系统的灵活性和扩展性，而工厂方法模式则可以很好地解决这一问题。</p> <p>在工厂方法模式中，我们不再提供一个统一的工厂类来创建所有的产品对象，而是针对不同的产品提供不同的工厂，系统提供一个与产品等级结构对应的工厂等级结构。工厂方法模式定义如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>   工厂方法模式(Factory Method Pattern)：定义一个用于创建对象的接口，让子类决定将哪一个类实例化。工厂方法模式让一个类的实例化延迟到其子类。工厂方法模式又简称为工厂模式(Factory Pattern)，又可称作虚拟构造器模式(Virtual Constructor Pattern)或多态工厂模式(Polymorphic Factory Pattern)。工厂方法模式是一种类创建型模式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>工厂方法模式提供一个抽象工厂接口来声明抽象工厂方法，而由其子类来具体实现工厂方法，创建具体的产品对象。工厂方法模式结构如图2所示：</p> <p><img src="/assets/img/s38.107d9ded.jpg" alt=""></p> <p>图2 工厂方法模式结构图</p> <p>在工厂方法模式结构图中包含如下几个角色：</p> <p>● Product（抽象产品）：它是定义产品的接口，是工厂方法模式所创建对象的超类型，也就是产品对象的公共父类。</p> <p>● ConcreteProduct（具体产品）：它实现了抽象产品接口，某种类型的具体产品由专门的具体工厂创建，具体工厂和具体产品之间一一对应。</p> <p>● Factory（抽象工厂）：在抽象工厂类中，声明了工厂方法(Factory Method)，用于返回一个产品。抽象工厂是工厂方法模式的核心，所有创建对象的工厂类都必须实现该接口。</p> <p>● ConcreteFactory（具体工厂）：它是抽象工厂类的子类，实现了抽象工厂中定义的工厂方法，并可由客户端调用，返回一个具体产品类的实例。</p> <p>与简单工厂模式相比，工厂方法模式最重要的区别是引入了抽象工厂角色，抽象工厂可以是接口，也可以是抽象类或者具体类，其典型代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">factoryMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在抽象工厂中声明了工厂方法但并未实现工厂方法，具体产品对象的创建由其子类负责，客户端针对抽象工厂编程，可在运行时再指定具体工厂类，具体工厂类实现了工厂方法，不同的具体工厂可以创建不同的具体产品，其典型代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ConcreteFactory</span> <span class="token keyword">implements</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">factoryMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在实际使用时，具体工厂类在实现工厂方法时除了创建具体产品对象之外，还可以负责产品对象的初始化工作以及一些资源和环境配置工作，例如连接数据库、创建文件等。</p> <p>在客户端代码中，只需关心工厂类即可，不同的具体工厂可以创建不同的产品，典型的客户端类代码片段如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>……
<span class="token class-name">Factory</span> factory<span class="token punctuation">;</span>
factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可通过配置文件实现</span>
<span class="token class-name">Product</span> product<span class="token punctuation">;</span>
product <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">factoryMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
……
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​       可以通过配置文件来存储具体工厂类ConcreteFactory的类名，更换新的具体工厂时无须修改源代码，系统扩展更为方便。</p> <h4 id="_3-解决"><a href="#_3-解决" class="header-anchor">#</a> 3 解决</h4> <p>Sunny公司开发人员决定使用工厂方法模式来设计日志记录器，其基本结构如图3所示：</p> <p><img src="/assets/img/s39.f58d255e.jpg" alt=""></p> <p>图3 日志记录器结构图</p> <p>在图3中，Logger接口充当抽象产品，其子类FileLogger和DatabaseLogger充当具体产品，LoggerFactory接口充当抽象工厂，其子类FileLoggerFactory和DatabaseLoggerFactory充当具体工厂。完整代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//日志记录器接口：抽象产品</span>
<span class="token keyword">interface</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//数据库日志记录器：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">DatabaseLogger</span> <span class="token keyword">implements</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;数据库日志记录。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//文件日志记录器：具体产品</span>
<span class="token keyword">class</span> <span class="token class-name">FileLogger</span> <span class="token keyword">implements</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;文件日志记录。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//日志记录器工厂接口：抽象工厂</span>
<span class="token keyword">interface</span> <span class="token class-name">LoggerFactory</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//数据库日志记录器工厂类：具体工厂</span>
<span class="token keyword">class</span> <span class="token class-name">DatabaseLoggerFactory</span> <span class="token keyword">implements</span> <span class="token class-name">LoggerFactory</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//连接数据库，代码省略</span>
			<span class="token comment">//创建数据库日志记录器对象</span>
			<span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
			<span class="token comment">//初始化数据库日志记录器，代码省略</span>
			<span class="token keyword">return</span> logger<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
 
<span class="token comment">//文件日志记录器工厂类：具体工厂</span>
<span class="token keyword">class</span> <span class="token class-name">FileLoggerFactory</span> <span class="token keyword">implements</span> <span class="token class-name">LoggerFactory</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//创建文件日志记录器对象</span>
			<span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
			<span class="token comment">//创建文件，代码省略</span>
			<span class="token keyword">return</span> logger<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>客户端测试代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">LoggerFactory</span> factory<span class="token punctuation">;</span>
		<span class="token class-name">Logger</span> logger<span class="token punctuation">;</span>
		factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileLoggerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可引入配置文件实现</span>
		logger <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		logger<span class="token punctuation">.</span><span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-cb1513f6></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.b77bd91d.js" defer></script><script src="/assets/js/5.95fafd89.js" defer></script><script src="/assets/js/1.8004d325.js" defer></script><script src="/assets/js/4.c5305843.js" defer></script>
  </body>
</html>
